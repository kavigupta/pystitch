{"backend/config.py": "# Useful for debugging purposes when you don't want to waste GPT4-Vision credits\n# Setting to True will stream a mock response instead of calling the OpenAI API\n# TODO: Should only be set to true when value is 'True', not any abitrary truthy value\nimport os\n\nANTHROPIC_API_KEY = os.environ.get(\"ANTHROPIC_API_KEY\", None)\n\n# Debugging-related\n\nSHOULD_MOCK_AI_RESPONSE = bool(os.environ.get(\"MOCK\", False))\nIS_DEBUG_ENABLED = bool(os.environ.get(\"IS_DEBUG_ENABLED\", False))\nDEBUG_DIR = os.environ.get(\"DEBUG_DIR\", \"\")\n\n# Set to True when running in production (on the hosted version)\n# Used as a feature flag to enable or disable certain features\nIS_PROD = os.environ.get(\"IS_PROD\", False)\n", "backend/video_to_app.py": "# Load environment variables first\n\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n\nimport base64\nimport mimetypes\nimport time\nimport subprocess\nimport os\nimport asyncio\nfrom datetime import datetime\nfrom prompts.claude_prompts import VIDEO_PROMPT\nfrom utils import pprint_prompt\nfrom config import ANTHROPIC_API_KEY\nfrom video.utils import extract_tag_content, assemble_claude_prompt_video\nfrom llm import (\n    Llm,\n    stream_claude_response_native,\n)\n\nSTACK = \"html_tailwind\"\n\nVIDEO_DIR = \"./video_evals/videos\"\nSCREENSHOTS_DIR = \"./video_evals/screenshots\"\nOUTPUTS_DIR = \"./video_evals/outputs\"\n\n\nasync def main():\n    video_filename = \"shortest.mov\"\n    is_followup = False\n\n    if not ANTHROPIC_API_KEY:\n        raise ValueError(\"ANTHROPIC_API_KEY is not set\")\n\n    # Get previous HTML\n    previous_html = \"\"\n    if is_followup:\n        previous_html_file = max(\n            [\n                os.path.join(OUTPUTS_DIR, f)\n                for f in os.listdir(OUTPUTS_DIR)\n                if f.endswith(\".html\")\n            ],\n            key=os.path.getctime,\n        )\n        with open(previous_html_file, \"r\") as file:\n            previous_html = file.read()\n\n    video_file = os.path.join(VIDEO_DIR, video_filename)\n    mime_type = mimetypes.guess_type(video_file)[0]\n    with open(video_file, \"rb\") as file:\n        video_content = file.read()\n    video_data_url = (\n        f\"data:{mime_type};base64,{base64.b64encode(video_content).decode('utf-8')}\"\n    )\n\n    prompt_messages = await assemble_claude_prompt_video(video_data_url)\n\n    # Tell the model to continue\n    # {\"role\": \"assistant\", \"content\": SECOND_MESSAGE},\n    # {\"role\": \"user\", \"content\": \"continue\"},\n\n    if is_followup:\n        prompt_messages += [\n            {\"role\": \"assistant\", \"content\": previous_html},\n            {\n                \"role\": \"user\",\n                \"content\": \"You've done a good job with a first draft. Improve this further based on the original instructions so that the app is fully functional like in the original video.\",\n            },\n        ]  # type: ignore\n\n    async def process_chunk(content: str):\n        print(content, end=\"\", flush=True)\n\n    response_prefix = \"<thinking>\"\n\n    pprint_prompt(prompt_messages)  # type: ignore\n\n    start_time = time.time()\n\n    completion = await stream_claude_response_native(\n        system_prompt=VIDEO_PROMPT,\n        messages=prompt_messages,\n        api_key=ANTHROPIC_API_KEY,\n        callback=lambda x: process_chunk(x),\n        model=Llm.CLAUDE_3_OPUS,\n        include_thinking=True,\n    )\n\n    end_time = time.time()\n\n    # Prepend the response prefix to the completion\n    completion = response_prefix + completion\n\n    # Extract the outputs\n    html_content = extract_tag_content(\"html\", completion)\n    thinking = extract_tag_content(\"thinking\", completion)\n\n    print(thinking)\n    print(f\"Operation took {end_time - start_time} seconds\")\n\n    os.makedirs(OUTPUTS_DIR, exist_ok=True)\n\n    # Generate a unique filename based on the current time\n    timestamp = datetime.now().strftime(\"%Y-%m-%d_%H-%M-%S\")\n    filename = f\"video_test_output_{timestamp}.html\"\n    output_path = os.path.join(OUTPUTS_DIR, filename)\n\n    # Write the HTML content to the file\n    with open(output_path, \"w\") as file:\n        file.write(html_content)\n\n    print(f\"Output file path: {output_path}\")\n\n    # Show a notification\n    subprocess.run([\"osascript\", \"-e\", 'display notification \"Coding Complete\"'])\n\n\nasyncio.run(main())\n", "backend/run_evals.py": "# Load environment variables first\nfrom dotenv import load_dotenv\n\nfrom llm import Llm\n\nload_dotenv()\n\nimport os\nfrom typing import Any, Coroutine\nimport asyncio\n\nfrom evals.config import EVALS_DIR\nfrom evals.core import generate_code_core\nfrom evals.utils import image_to_data_url\n\nSTACK = \"ionic_tailwind\"\nMODEL = Llm.GPT_4O_2024_05_13\nN = 1  # Number of outputs to generate\n\n\nasync def main():\n    INPUT_DIR = EVALS_DIR + \"/inputs\"\n    OUTPUT_DIR = EVALS_DIR + \"/outputs\"\n\n    # Get all the files in the directory (only grab pngs)\n    evals = [f for f in os.listdir(INPUT_DIR) if f.endswith(\".png\")]\n\n    tasks: list[Coroutine[Any, Any, str]] = []\n    for filename in evals:\n        filepath = os.path.join(INPUT_DIR, filename)\n        data_url = await image_to_data_url(filepath)\n        for _ in range(N):  # Generate N tasks for each input\n            task = generate_code_core(image_url=data_url, stack=STACK, model=MODEL)\n            tasks.append(task)\n\n    results = await asyncio.gather(*tasks)\n\n    os.makedirs(OUTPUT_DIR, exist_ok=True)\n\n    for i, content in enumerate(results):\n        # Calculate index for filename and output number\n        eval_index = i // N\n        output_number = i % N\n        filename = evals[eval_index]\n        # File name is derived from the original filename in evals with an added output number\n        output_filename = f\"{os.path.splitext(filename)[0]}_{output_number}.html\"\n        output_filepath = os.path.join(OUTPUT_DIR, output_filename)\n        with open(output_filepath, \"w\") as file:\n            file.write(content)\n\n\nasyncio.run(main())\n", "backend/mock_llm.py": "import asyncio\nfrom typing import Awaitable, Callable\n\nfrom custom_types import InputMode\n\n\nSTREAM_CHUNK_SIZE = 20\n\n\nasync def mock_completion(\n    process_chunk: Callable[[str], Awaitable[None]], input_mode: InputMode\n) -> str:\n    code_to_return = (\n        TALLY_FORM_VIDEO_PROMPT_MOCK\n        if input_mode == \"video\"\n        else NO_IMAGES_NYTIMES_MOCK_CODE\n    )\n\n    for i in range(0, len(code_to_return), STREAM_CHUNK_SIZE):\n        await process_chunk(code_to_return[i : i + STREAM_CHUNK_SIZE])\n        await asyncio.sleep(0.01)\n\n    if input_mode == \"video\":\n        # Extract the last <html></html> block from code_to_return\n        # because we can have multiple passes\n        start = code_to_return.rfind(\"<html\")\n        end = code_to_return.rfind(\"</html>\") + len(\"</html>\")\n        if start != -1 and end != -1:\n            code_to_return = code_to_return[start:end]\n        else:\n            code_to_return = \"Error: HTML block not found.\"\n\n    return code_to_return\n\n\nAPPLE_MOCK_CODE = \"\"\"<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Product Showcase</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap\" rel=\"stylesheet\">\n    <style>\n        body {\n            font-family: 'Roboto', sans-serif;\n        }\n    </style>\n</head>\n<body class=\"bg-black text-white\">\n    <nav class=\"py-6\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center\">\n            <div class=\"flex items-center\">\n                <img src=\"https://placehold.co/24x24\" alt=\"Company Logo\" class=\"mr-8\">\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\">Store</a>\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\">Mac</a>\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\">iPad</a>\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\">iPhone</a>\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\">Watch</a>\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\">Vision</a>\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\">AirPods</a>\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\">TV & Home</a>\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\">Entertainment</a>\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\">Accessories</a>\n                <a href=\"#\" class=\"text-white text-sm font-medium\">Support</a>\n            </div>\n            <div class=\"flex items-center\">\n                <a href=\"#\" class=\"text-white text-sm font-medium mr-4\"><i class=\"fas fa-search\"></i></a>\n                <a href=\"#\" class=\"text-white text-sm font-medium\"><i class=\"fas fa-shopping-bag\"></i></a>\n            </div>\n        </div>\n    </nav>\n\n    <main class=\"mt-8\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"text-center\">\n                <img src=\"https://placehold.co/100x100\" alt=\"Brand Logo\" class=\"mx-auto mb-4\">\n                <h1 class=\"text-5xl font-bold mb-4\">WATCH SERIES 9</h1>\n                <p class=\"text-2xl font-medium mb-8\">Smarter. Brighter. Mightier.</p>\n                <div class=\"flex justify-center space-x-4\">\n                    <a href=\"#\" class=\"text-blue-600 text-sm font-medium\">Learn more ></a>\n                    <a href=\"#\" class=\"text-blue-600 text-sm font-medium\">Buy ></a>\n                </div>\n            </div>\n            <div class=\"flex justify-center mt-12\">\n                <img src=\"https://placehold.co/500x300\" alt=\"Product image of a smartwatch with a pink band and a circular interface displaying various health metrics.\" class=\"mr-8\">\n                <img src=\"https://placehold.co/500x300\" alt=\"Product image of a smartwatch with a blue band and a square interface showing a classic analog clock face.\" class=\"ml-8\">\n            </div>\n        </div>\n    </main>\n</body>\n</html>\"\"\"\n\nNYTIMES_MOCK_CODE = \"\"\"\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>The New York Times - News</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <link href=\"https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\">\n    <style>\n        body {\n            font-family: 'Libre Franklin', sans-serif;\n        }\n    </style>\n</head>\n<body class=\"bg-gray-100\">\n    <div class=\"container mx-auto px-4\">\n        <header class=\"border-b border-gray-300 py-4\">\n            <div class=\"flex justify-between items-center\">\n                <div class=\"flex items-center space-x-4\">\n                    <button class=\"text-gray-700\"><i class=\"fas fa-bars\"></i></button>\n                    <button class=\"text-gray-700\"><i class=\"fas fa-search\"></i></button>\n                    <div class=\"text-xs uppercase tracking-widest\">Tuesday, November 14, 2023<br>Today's Paper</div>\n                </div>\n                <div>\n                    <img src=\"https://placehold.co/200x50?text=The+New+York+Times+Logo\" alt=\"The New York Times Logo\" class=\"h-8\">\n                </div>\n                <div class=\"flex items-center space-x-4\">\n                    <button class=\"bg-black text-white px-4 py-1 text-xs uppercase tracking-widest\">Give the times</button>\n                    <div class=\"text-xs\">Account</div>\n                </div>\n            </div>\n            <nav class=\"flex justify-between items-center py-4\">\n                <div class=\"flex space-x-4\">\n                    <a href=\"#\" class=\"text-xs uppercase tracking-widest text-gray-700\">U.S.</a>\n                    <!-- Add other navigation links as needed -->\n                </div>\n                <div class=\"flex space-x-4\">\n                    <a href=\"#\" class=\"text-xs uppercase tracking-widest text-gray-700\">Cooking</a>\n                    <!-- Add other navigation links as needed -->\n                </div>\n            </nav>\n        </header>\n        <main>\n            <section class=\"py-6\">\n                <div class=\"grid grid-cols-3 gap-4\">\n                    <div class=\"col-span-2\">\n                        <article class=\"mb-4\">\n                            <h2 class=\"text-xl font-bold mb-2\">Israeli Military Raids Gaza\u2019s Largest Hospital</h2>\n                            <p class=\"text-gray-700 mb-2\">Israeli troops have entered the Al-Shifa Hospital complex, where conditions have grown dire and Israel says Hamas fighters are embedded.</p>\n                            <a href=\"#\" class=\"text-blue-600 text-sm\">See more updates <i class=\"fas fa-external-link-alt\"></i></a>\n                        </article>\n                        <!-- Repeat for each news item -->\n                    </div>\n                    <div class=\"col-span-1\">\n                        <article class=\"mb-4\">\n                            <img src=\"https://placehold.co/300x200?text=News+Image\" alt=\"Flares and plumes of smoke over the northern Gaza skyline on Tuesday.\" class=\"mb-2\">\n                            <h2 class=\"text-xl font-bold mb-2\">From Elvis to Elopements, the Evolution of the Las Vegas Wedding</h2>\n                            <p class=\"text-gray-700 mb-2\">The glittering city that attracts thousands of couples seeking unconventional nuptials has grown beyond the drive-through wedding.</p>\n                            <a href=\"#\" class=\"text-blue-600 text-sm\">8 MIN READ</a>\n                        </article>\n                        <!-- Repeat for each news item -->\n                    </div>\n                </div>\n            </section>\n        </main>\n    </div>\n</body>\n</html>\n\"\"\"\n\nNO_IMAGES_NYTIMES_MOCK_CODE = \"\"\"\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>The New York Times - News</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <link href=\"https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;700&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\">\n    <style>\n        body {\n            font-family: 'Libre Franklin', sans-serif;\n        }\n    </style>\n</head>\n<body class=\"bg-gray-100\">\n    <div class=\"container mx-auto px-4\">\n        <header class=\"border-b border-gray-300 py-4\">\n            <div class=\"flex justify-between items-center\">\n                <div class=\"flex items-center space-x-4\">\n                    <button class=\"text-gray-700\"><i class=\"fas fa-bars\"></i></button>\n                    <button class=\"text-gray-700\"><i class=\"fas fa-search\"></i></button>\n                    <div class=\"text-xs uppercase tracking-widest\">Tuesday, November 14, 2023<br>Today's Paper</div>\n                </div>\n                <div class=\"flex items-center space-x-4\">\n                    <button class=\"bg-black text-white px-4 py-1 text-xs uppercase tracking-widest\">Give the times</button>\n                    <div class=\"text-xs\">Account</div>\n                </div>\n            </div>\n            <nav class=\"flex justify-between items-center py-4\">\n                <div class=\"flex space-x-4\">\n                    <a href=\"#\" class=\"text-xs uppercase tracking-widest text-gray-700\">U.S.</a>\n                    <!-- Add other navigation links as needed -->\n                </div>\n                <div class=\"flex space-x-4\">\n                    <a href=\"#\" class=\"text-xs uppercase tracking-widest text-gray-700\">Cooking</a>\n                    <!-- Add other navigation links as needed -->\n                </div>\n            </nav>\n        </header>\n        <main>\n            <section class=\"py-6\">\n                <div class=\"grid grid-cols-3 gap-4\">\n                    <div class=\"col-span-2\">\n                        <article class=\"mb-4\">\n                            <h2 class=\"text-xl font-bold mb-2\">Israeli Military Raids Gaza\u2019s Largest Hospital</h2>\n                            <p class=\"text-gray-700 mb-2\">Israeli troops have entered the Al-Shifa Hospital complex, where conditions have grown dire and Israel says Hamas fighters are embedded.</p>\n                            <a href=\"#\" class=\"text-blue-600 text-sm\">See more updates <i class=\"fas fa-external-link-alt\"></i></a>\n                        </article>\n                        <!-- Repeat for each news item -->\n                    </div>\n                    <div class=\"col-span-1\">\n                        <article class=\"mb-4\">\n                            <h2 class=\"text-xl font-bold mb-2\">From Elvis to Elopements, the Evolution of the Las Vegas Wedding</h2>\n                            <p class=\"text-gray-700 mb-2\">The glittering city that attracts thousands of couples seeking unconventional nuptials has grown beyond the drive-through wedding.</p>\n                            <a href=\"#\" class=\"text-blue-600 text-sm\">8 MIN READ</a>\n                        </article>\n                        <!-- Repeat for each news item -->\n                    </div>\n                </div>\n            </section>\n        </main>\n    </div>\n</body>\n</html>\n\"\"\"\n\nMORTGAGE_CALCULATOR_VIDEO_PROMPT_MOCK = \"\"\"\n<thinking>\nThe user flow in the video seems to be:\n1. The calculator starts with some default values for loan amount, loan term, interest rate, etc. \n2. The user toggles the \"Include taxes & fees\" checkbox which shows an explanation tooltip.\n3. The user selects different loan terms from the dropdown, which updates the monthly payment amount.\n4. The user enters a custom loan amount.\n5. The user selects a different loan term (30-yr fixed FHA).\n6. The user enters additional details like home price, down payment, state, credit score, property tax, home insurance, and HOA fees.\n7. The calculator updates the total monthly payment breakdown.\n\nTo build this:\n- Use a container div for the whole calculator\n- Have sections for Monthly Payment, Purchase Budget, loan details, additional costs\n- Use input fields, dropdowns, and checkboxes for user input\n- Update values dynamically using JavaScript when inputs change\n- Show/hide explanation tooltip when checkbox is toggled\n- Update monthly payment whenever loan amount, interest rate or term is changed\n- Allow selecting loan term from a dropdown \n- Update total monthly payment breakdown as additional costs are entered\n- Style everything to match the screenshots using Tailwind utility classes\n</thinking>\n\n<html>\n<head>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <script src=\"https://code.jquery.com/jquery-3.7.1.min.js\"></script>\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\">\n</head>\n<body>\n<div class=\"max-w-lg mx-auto bg-white shadow-lg rounded-lg p-6 font-sans\">\n  <div class=\"text-2xl font-semibold mb-6\">Mortgage Calculator</div>\n  \n  <div class=\"flex justify-between text-sm uppercase font-semibold text-gray-500 border-b mb-4\">\n    <div class=\"pb-2 border-b-2 border-blue-500\">Monthly payment</div>\n    <div class=\"pb-2\">Purchase budget</div>\n  </div>\n\n  <div class=\"flex items-center mb-4\">\n    <input type=\"checkbox\" class=\"mr-2 taxes-toggle\" id=\"taxesToggle\">\n    <label for=\"taxesToggle\" class=\"text-sm\">Include taxes & fees</label>\n    <i class=\"fas fa-info-circle ml-1 text-gray-400 cursor-pointer\" id=\"taxesInfo\"></i>\n    <div class=\"hidden bg-gray-100 text-xs p-2 ml-2 rounded\" id=\"taxesTooltip\">Your total monthly payment is more than just your mortgage. It can include property taxes, homeowners insurance, and HOA fees, among other things.</div>\n  </div>\n\n  <div class=\"text-3xl font-semibold mb-4\">$<span id=\"monthlyPayment\">1,696</span></div>\n\n  <div class=\"mb-4\">\n    <div class=\"text-sm font-semibold mb-2\">Loan amount</div>\n    <input type=\"text\" value=\"240,000\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"loanAmount\">\n  </div>\n\n  <div class=\"mb-4\">\n    <div class=\"text-sm font-semibold mb-2\">Loan term</div>\n    <select class=\"w-full border rounded px-2 py-1 text-lg\" id=\"loanTerm\">\n      <option>30-yr fixed</option>\n      <option>30-yr fixed FHA</option>\n      <option>30-yr fixed VA</option>\n      <option>30-yr fixed USDA</option>\n      <option>20-yr fixed</option>\n      <option>15-yr fixed</option>\n      <option>10 / 6 ARM</option>\n      <option>7 / 6 ARM</option>\n      <option>5 / 6 ARM</option>\n      <option>3 / 6 ARM</option>\n    </select>\n  </div>\n\n  <div class=\"flex justify-between mb-4\">\n    <div>\n      <div class=\"text-sm font-semibold mb-2\">Interest</div>\n      <div class=\"text-lg\">7.61 %</div>\n    </div>\n    <i class=\"fas fa-info-circle text-gray-400 cursor-pointer self-center\"></i>\n  </div>\n\n  <div class=\"border-t pt-4\">\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Home price</div>\n      <input type=\"text\" value=\"300,000\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"homePrice\">\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Down payment</div>\n      <div class=\"flex\">\n        <input type=\"text\" value=\"60,000\" class=\"w-full border rounded-l px-2 py-1 text-lg\" id=\"downPayment\">\n        <div class=\"bg-gray-200 rounded-r px-4 py-1 text-lg flex items-center\">20 %</div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"border-t pt-4\">\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">State</div>\n      <select class=\"w-full border rounded px-2 py-1 text-lg\" id=\"state\">\n        <option>New York</option>\n      </select>\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Credit score</div>\n      <select class=\"w-full border rounded px-2 py-1 text-lg\" id=\"creditScore\">\n        <option>700 - 719</option>\n      </select>\n    </div>\n  </div>\n\n  <div class=\"border-t pt-4\">\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Property tax (yearly)</div>\n      <input type=\"text\" value=\"3,750\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"propertyTax\">\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Home insurance (yearly)</div>\n      <input type=\"text\" value=\"1,050\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"homeInsurance\">\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Private mortgage insurance (monthly)</div>\n      <input type=\"text\" value=\"0\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"mortgageInsurance\">\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Homeowners association (monthly)</div>\n      <input type=\"text\" value=\"0\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"hoaFees\">\n    </div>\n  </div>\n\n  <div class=\"flex justify-between pt-4\">\n    <div class=\"text-sm\">\n      <div class=\"font-semibold\">Total monthly payment</div>\n      <div class=\"text-3xl font-semibold\">$<span id=\"totalPayment\">2,036</span></div>\n    </div>\n    <div class=\"text-right\">\n      <div class=\"text-sm\">Loan</div>\n      <div class=\"text-lg\">$<span id=\"loanPayment\">1,635</span></div>\n      <div class=\"text-sm\">Taxes & fees</div>\n      <div>$<span id=\"taxesPayment\">401</span></div>\n    </div>\n  </div>\n\n  <div class=\"text-xs text-gray-500 mt-4\">\n    <div>Disclaimer \u2022 Feedback</div>\n  </div>\n</div>\n\n<script>\n$(document).ready(function() {\n  var loanAmount = 240000;\n  var interestRate = 7.61;\n  var loanTerm = 30;\n  var homePrice = 300000;\n  var downPayment = 60000;\n  var propertyTax = 3750;\n  var homeInsurance = 1050;\n  var mortgageInsurance = 0;\n  var hoaFees = 0;\n\n  function updateCalculations() {\n    var principal = loanAmount;\n    var monthlyInterest = interestRate / 100 / 12;\n    var numPayments = loanTerm * 12;\n    var monthlyPayment = principal * monthlyInterest / (1 - (Math.pow(1/(1 + monthlyInterest), numPayments)));\n    var totalPayment = monthlyPayment;\n    var taxesPayment = (propertyTax + homeInsurance) / 12;\n\n    if ($('#taxesToggle').is(':checked')) {\n      totalPayment += taxesPayment + mortgageInsurance + hoaFees;\n    }\n\n    $('#monthlyPayment').text(Math.round(monthlyPayment).toLocaleString());\n    $('#loanPayment').text(Math.round(monthlyPayment).toLocaleString());\n    $('#taxesPayment').text(Math.round(taxesPayment + mortgageInsurance + hoaFees).toLocaleString());\n    $('#totalPayment').text(Math.round(totalPayment).toLocaleString());\n  }\n\n  $('#taxesInfo').hover(function() {\n    $('#taxesTooltip').removeClass('hidden');\n  }, function() {\n    $('#taxesTooltip').addClass('hidden');\n  });\n\n  $('#loanTerm').change(function() {\n    loanTerm = parseInt($(this).val().split('-')[0]);\n    updateCalculations();\n  });\n\n  $('#loanAmount').change(function() {\n    loanAmount = parseInt($(this).val().replace(/,/g, ''));\n    updateCalculations();\n  });\n\n  $('#homePrice').change(function() {\n    homePrice = parseInt($(this).val().replace(/,/g, ''));\n    loanAmount = homePrice - downPayment;\n    $('#loanAmount').val(loanAmount.toLocaleString());\n    updateCalculations();\n  });\n\n  $('#downPayment').change(function() {\n    downPayment = parseInt($(this).val().replace(/,/g, ''));\n    loanAmount = homePrice - downPayment;\n    $('#loanAmount').val(loanAmount.toLocaleString());\n    updateCalculations();\n  });\n\n  $('#propertyTax').change(function() {\n    propertyTax = parseInt($(this).val().replace(/,/g, ''));\n    updateCalculations();\n  });\n\n  $('#homeInsurance').change(function() {\n    homeInsurance = parseInt($(this).val().replace(/,/g, ''));\n    updateCalculations();\n  });\n\n  $('#mortgageInsurance').change(function() {\n    mortgageInsurance = parseInt($(this).val().replace(/,/g, ''));\n    updateCalculations();\n  });\n\n  $('#hoaFees').change(function() {\n    hoaFees = parseInt($(this).val().replace(/,/g, ''));\n    updateCalculations();\n  });\n\n  updateCalculations();\n});\n</script>\n</body>\n</html>\n\n<thinking>\nMore things to consider:\n- Add validation to input fields to prevent non-numeric values\n- Add a reset button to clear all inputs and reset to default values\n</thinking>\n\n<html>\n<head>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <script src=\"https://code.jquery.com/jquery-3.7.1.min.js\"></script>\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\">\n</head>\n<body>\n<div class=\"max-w-lg mx-auto bg-black text-white shadow-lg rounded-lg p-6 font-sans\">\n  <div class=\"text-2xl font-semibold mb-6\">Mortgage Calculator</div>\n  \n  <div class=\"flex justify-between text-sm uppercase font-semibold text-gray-500 border-b mb-4\">\n    <div class=\"pb-2 border-b-2 border-blue-500\">Monthly payment</div>\n    <div class=\"pb-2\">Purchase budget</div>\n  </div>\n\n  <div class=\"flex items-center mb-4\">\n    <input type=\"checkbox\" class=\"mr-2 taxes-toggle\" id=\"taxesToggle\">\n    <label for=\"taxesToggle\" class=\"text-sm\">Include taxes & fees</label>\n    <i class=\"fas fa-info-circle ml-1 text-gray-400 cursor-pointer\" id=\"taxesInfo\"></i>\n    <div class=\"hidden bg-gray-100 text-xs p-2 ml-2 rounded\" id=\"taxesTooltip\">Your total monthly payment is more than just your mortgage. It can include property taxes, homeowners insurance, and HOA fees, among other things.</div>\n  </div>\n\n  <div class=\"text-3xl font-semibold mb-4\">$<span id=\"monthlyPayment\">1,696</span></div>\n\n  <div class=\"mb-4\">\n    <div class=\"text-sm font-semibold mb-2\">Loan amount</div>\n    <input type=\"text\" value=\"240,000\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"loanAmount\">\n  </div>\n\n  <div class=\"mb-4\">\n    <div class=\"text-sm font-semibold mb-2\">Loan term</div>\n    <select class=\"w-full border rounded px-2 py-1 text-lg\" id=\"loanTerm\">\n      <option>30-yr fixed</option>\n      <option>30-yr fixed FHA</option>\n      <option>30-yr fixed VA</option>\n      <option>30-yr fixed USDA</option>\n      <option>20-yr fixed</option>\n      <option>15-yr fixed</option>\n      <option>10 / 6 ARM</option>\n      <option>7 / 6 ARM</option>\n      <option>5 / 6 ARM</option>\n      <option>3 / 6 ARM</option>\n    </select>\n  </div>\n\n  <div class=\"flex justify-between mb-4\">\n    <div>\n      <div class=\"text-sm font-semibold mb-2\">Interest</div>\n      <div class=\"text-lg\">7.61 %</div>\n    </div>\n    <i class=\"fas fa-info-circle text-gray-400 cursor-pointer self-center\"></i>\n  </div>\n\n  <div class=\"border-t pt-4\">\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Home price</div>\n      <input type=\"text\" value=\"300,000\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"homePrice\">\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Down payment</div>\n      <div class=\"flex\">\n        <input type=\"text\" value=\"60,000\" class=\"w-full border rounded-l px-2 py-1 text-lg\" id=\"downPayment\">\n        <div class=\"bg-gray-200 rounded-r px-4 py-1 text-lg flex items-center\">20 %</div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"border-t pt-4\">\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">State</div>\n      <select class=\"w-full border rounded px-2 py-1 text-lg\" id=\"state\">\n        <option>New York</option>\n      </select>\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Credit score</div>\n      <select class=\"w-full border rounded px-2 py-1 text-lg\" id=\"creditScore\">\n        <option>700 - 719</option>\n      </select>\n    </div>\n  </div>\n\n  <div class=\"border-t pt-4\">\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Property tax (yearly)</div>\n      <input type=\"text\" value=\"3,750\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"propertyTax\">\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Home insurance (yearly)</div>\n      <input type=\"text\" value=\"1,050\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"homeInsurance\">\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Private mortgage insurance (monthly)</div>\n      <input type=\"text\" value=\"0\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"mortgageInsurance\">\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"text-sm font-semibold mb-2\">Homeowners association (monthly)</div>\n      <input type=\"text\" value=\"0\" class=\"w-full border rounded px-2 py-1 text-lg\" id=\"hoaFees\">\n    </div>\n  </div>\n\n  <div class=\"flex justify-between pt-4\">\n    <div class=\"text-sm\">\n      <div class=\"font-semibold\">Total monthly payment</div>\n      <div class=\"text-3xl font-semibold\">$<span id=\"totalPayment\">2,036</span></div>\n    </div>\n    <div class=\"text-right\">\n      <div class=\"text-sm\">Loan</div>\n      <div class=\"text-lg\">$<span id=\"loanPayment\">1,635</span></div>\n      <div class=\"text-sm\">Taxes & fees</div>\n      <div>$<span id=\"taxesPayment\">401</span></div>\n    </div>\n  </div>\n\n  <div class=\"text-xs text-gray-500 mt-4\">\n    <div>Disclaimer \u2022 Feedback</div>\n  </div>\n</div>\n\n<script>\n$(document).ready(function() {\n  var loanAmount = 240000;\n  var interestRate = 7.61;\n  var loanTerm = 30;\n  var homePrice = 300000;\n  var downPayment = 60000;\n  var propertyTax = 3750;\n  var homeInsurance = 1050;\n  var mortgageInsurance = 0;\n  var hoaFees = 0;\n\n  function updateCalculations() {\n    var principal = loanAmount;\n    var monthlyInterest = interestRate / 100 / 12;\n    var numPayments = loanTerm * 12;\n    var monthlyPayment = principal * monthlyInterest / (1 - (Math.pow(1/(1 + monthlyInterest), numPayments)));\n    var totalPayment = monthlyPayment;\n    var taxesPayment = (propertyTax + homeInsurance) / 12;\n\n    if ($('#taxesToggle').is(':checked')) {\n      totalPayment += taxesPayment + mortgageInsurance + hoaFees;\n    }\n\n    $('#monthlyPayment').text(Math.round(monthlyPayment).toLocaleString());\n    $('#loanPayment').text(Math.round(monthlyPayment).toLocaleString());\n    $('#taxesPayment').text(Math.round(taxesPayment + mortgageInsurance + hoaFees).toLocaleString());\n    $('#totalPayment').text(Math.round(totalPayment).toLocaleString());\n  }\n\n  $('#taxesInfo').hover(function() {\n    $('#taxesTooltip').removeClass('hidden');\n  }, function() {\n    $('#taxesTooltip').addClass('hidden');\n  });\n\n  $('#loanTerm').change(function() {\n    loanTerm = parseInt($(this).val().split('-')[0]);\n    updateCalculations();\n  });\n\n  $('#loanAmount').change(function() {\n    loanAmount = parseInt($(this).val().replace(/,/g, ''));\n    updateCalculations();\n  });\n\n  $('#homePrice').change(function() {\n    homePrice = parseInt($(this).val().replace(/,/g, ''));\n    loanAmount = homePrice - downPayment;\n    $('#loanAmount').val(loanAmount.toLocaleString());\n    updateCalculations();\n  });\n\n  $('#downPayment').change(function() {\n    downPayment = parseInt($(this).val().replace(/,/g, ''));\n    loanAmount = homePrice - downPayment;\n    $('#loanAmount').val(loanAmount.toLocaleString());\n    updateCalculations();\n  });\n\n  $('#propertyTax').change(function() {\n    propertyTax = parseInt($(this).val().replace(/,/g, ''));\n    updateCalculations();\n  });\n\n  $('#homeInsurance').change(function() {\n    homeInsurance = parseInt($(this).val().replace(/,/g, ''));\n    updateCalculations();\n  });\n\n  $('#mortgageInsurance').change(function() {\n    mortgageInsurance = parseInt($(this).val().replace(/,/g, ''));\n    updateCalculations();\n  });\n\n  $('#hoaFees').change(function() {\n    hoaFees = parseInt($(this).val().replace(/,/g, ''));\n    updateCalculations();\n  });\n\n  updateCalculations();\n});\n</script>\n</body>\n</html>\n\n\"\"\"\n\nGOOGLE_FORM_VIDEO_PROMPT_MOCK = \"\"\"\n\n<thinking>User flow:\n1. User starts on the Google search page and types in \"times\" in the search bar\n2. As the user types, Google provides autocomplete suggestions related to \"times\"\n3. User selects the \"times\" suggestion from the autocomplete dropdown\n4. The search results page for \"times\" loads, showing various results related to The New York Times newspaper\n5. User clicks the \"Generate\" button under \"Get an AI-powered overview for this search?\"\n6. An AI-generated overview about The New York Times loads on the right side of the search results\n\nCode structure:\n- HTML structure with header, search bar, autocomplete dropdown, search button\n- Search results area to display search results\n- Sidebar area to display the AI-generated overview\n- Use Tailwind CSS utility classes for styling\n- Use jQuery to handle user interactions:\n  - Typing in search bar to show/filter autocomplete suggestions\n  - Selecting autocomplete suggestion to populate search bar\n  - Clicking search button to display search results\n  - Clicking \"Generate\" button to display AI overview\n- Hardcode search results and AI overview content for demo purposes\n</thinking>\n\n<html>\n<head>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n  <script src=\"https://code.jquery.com/jquery-3.7.1.min.js\"></script>\n</head>\n<body>\n\n<div class=\"flex flex-col h-screen\">\n  <div class=\"flex items-center gap-4 px-5 py-3\">\n    <img class=\"w-24\" src=\"https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_92x30dp.png\" alt=\"Google logo\">\n    <div class=\"flex-grow relative\">\n      <input type=\"text\" id=\"search\" class=\"w-full px-4 py-2 text-lg border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500\" placeholder=\"Search Google or type a URL\">\n      <div id=\"autocomplete\" class=\"absolute w-full bg-white border border-gray-100 rounded-md shadow-lg z-10 hidden\">\n        <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">times</div>\n        <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">ts-ebml</div>\n        <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">tiktok ceo</div>\n        <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">two videos</div>\n        <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">Taskrabbit</div>\n        <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">translate</div>\n        <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">Target</div>\n        <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">Taylor Swift</div>\n        <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">Travis Kelce</div>\n        <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">Temu</div>\n      </div>\n    </div>\n    <button id=\"search-btn\" class=\"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md ml-2\">\n      <i class=\"fas fa-search\"></i>\n    </button>\n    <img class=\"w-8 h-8 rounded-full ml-4\" src=\"https://via.placeholder.com/150\" alt=\"Profile picture of the user\">\n  </div>\n  \n  <div class=\"flex-grow overflow-y-auto\">\n    <div id=\"search-results\" class=\"p-8 hidden\">\n      <div class=\"text-sm text-gray-600 mb-4\">Results for New York, NY 10022 - Choose area</div>\n      \n      <div class=\"bg-blue-50 p-4 mb-4\">\n        <button id=\"overview-btn\" class=\"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md\">Get an AI-powered overview for this search?</button>\n      </div>\n      \n      <div class=\"mb-4\">\n        <div class=\"text-xl text-blue-800 mb-1\">\n          <a href=\"https://www.nytimes.com\">The New York Times</a>\n        </div>\n        <div class=\"text-sm text-gray-800 mb-1\">https://www.nytimes.com</div>\n        <div class=\"text-sm text-gray-600\">\n          The New York Times - Breaking News, US News, World News ...\n        </div>\n        <div class=\"text-sm text-gray-600\">  \n          Live news, investigations, opinion, photos and video by the journalists of The New York Times from more than 150 countries around the world.\n        </div>\n      </div>\n\n      <div class=\"mb-4\">\n        <div class=\"text-sm text-gray-600 mb-1\">Opinion | The House Vote to Force TikTok's Sale Is a Mistake - The ...</div>\n        <div class=\"text-sm text-gray-600\">Why Are Lawmakers Trying to Ban TikTok Instead of Doing What ...</div>\n      </div>\n\n      <div class=\"mb-4\">  \n        <div class=\"text-sm text-gray-600 mb-1\">The Crossword</div>\n        <div class=\"text-sm text-gray-600\">Play the Daily New York Times Crossword puzzle edited by Will ...</div>\n      </div>\n\n      <div class=\"mb-4\">\n        <div class=\"text-sm text-gray-600 mb-1\">Today's Paper</div>\n        <div class=\"text-sm text-gray-600\">Today's Paper \u00b7 The Front Page \u00b7 Highlights \u00b7 Lawyer, Author ...</div>\n      </div>\n\n      <div class=\"mb-4\">\n        <div class=\"text-sm text-gray-600 mb-1\">Word game Wordle</div>\n        <div class=\"text-sm text-gray-600\">Get 6 chances to guess a 5-letter word.Get 6 chances to guess a ...</div>\n      </div>\n\n      <div>\n        <div class=\"text-sm text-gray-600\">Connections</div>\n        <div class=\"text-sm text-gray-600\">A look at the links between The Times and the world it covers.</div>\n      </div>\n    </div>\n    \n    <div id=\"overview\" class=\"p-8 hidden\">\n      <h2 class=\"text-2xl font-bold mb-4\">The New York Times</h2>\n      <div class=\"mb-4\">\n        <div class=\"font-bold\">Newspaper</div>\n      </div>\n      <div class=\"mb-4\">  \n        <div class=\"font-bold\">Owner:</div>\n        <div>The New York Times Company</div>\n      </div>\n      <div class=\"mb-4\">\n        <div class=\"font-bold\">Publisher:</div>  \n        <div>The New York Times Company</div>\n      </div>\n      <div class=\"mb-4\">\n        <div class=\"font-bold\">Founders:</div>\n        <div>George Jones, Henry Jarvis Raymond</div>  \n      </div>\n      <div class=\"mb-4\">\n        <div class=\"font-bold\">Circulation:</div>\n        <div>10,360,000 news subscribers (as of February 2024)</div>\n      </div>\n      <div class=\"mb-4\">  \n        <div class=\"font-bold\">Editor-in-chief:</div>\n        <div>Joseph Kahn</div>\n      </div>\n      <div class=\"mb-4\">\n        <div class=\"font-bold\">Format:</div>\n        <div>Broadsheet</div>\n      </div>\n      <div>  \n        <div class=\"font-bold\">Founded:</div> \n        <div>September 18, 1851; 172 years ago</div>\n      </div>\n    </div>\n  </div>\n</div>\n\n<script>\n$(document).ready(function() {\n  let selectedText = \"\";\n  \n  $(\"#search\").on(\"input\", function() {\n    const searchText = $(this).val().trim();\n    \n    if (searchText !== \"\") {\n      $(\"#autocomplete\").removeClass(\"hidden\");\n      $(\"#autocomplete div\").each(function() {\n        if ($(this).text().toLowerCase().startsWith(searchText.toLowerCase())) {\n          $(this).removeClass(\"hidden\");\n        } else {\n          $(this).addClass(\"hidden\");\n        }\n      });\n    } else {\n      $(\"#autocomplete\").addClass(\"hidden\");\n    }\n  });\n  \n  $(\"#autocomplete div\").click(function() {\n    selectedText = $(this).text();\n    $(\"#search\").val(selectedText);\n    $(\"#autocomplete\").addClass(\"hidden\");\n  });\n  \n  $(\"#search-btn\").click(function() {\n    if (selectedText !== \"\") {\n      $(\"#search-results\").removeClass(\"hidden\");\n      $(\"#overview\").addClass(\"hidden\");\n    }\n  });\n  \n  $(\"#overview-btn\").click(function() {\n    $(\"#overview\").removeClass(\"hidden\");\n  });\n});\n</script>\n\n</body>\n</html>\n\n<thinking>\nTo improve the app further and make it fully functional like the original video:\n\n1. Add more visual styling to match the original, including:\n   - Google logo and favicon\n   - User profile icon\n   - Search bar styling and hover effects\n   - Search button icon and styling\n   - Fonts and text sizes\n   - Spacing and layout adjustments\n\n2. Implement the search functionality:\n   - Perform a search when the user presses Enter or clicks the search button\n   - Show a loading state while searching\n   - Display the search results dynamically based on the query\n   - Handle cases when no results are found\n\n3. Enhance the autocomplete functionality:\n   - Fetch autocomplete suggestions from a data source based on the user's input\n   - Highlight the text match in the suggestions\n   - Allow navigating the suggestions with arrow keys\n   - Update the search input when a suggestion is selected\n\n4. Improve the AI-powered overview:\n   - Fetch the overview content dynamically based on the search query\n   - Display a loading state while generating the overview\n   - Enhance the styling of the overview to match the original\n\n5. Add additional UI elements:\n   - Header navigation tabs (About, Store, Gmail, Images)\n   - Footer links (Advertising, Business, How Search works, Privacy, Terms)\n   - Pagination for search results\n   - Feedback link\n\n6. Optimize performance:\n   - Lazy-load images and content\n   - Implement caching mechanisms\n   - Minify and compress assets\n\n7. Ensure responsiveness:\n   - Make the layout responsive and mobile-friendly\n   - Adjust font sizes, padding, and margins for different screen sizes\n   - Hide/collapse certain elements on smaller screens\n\n8. Enhance accessibility:\n   - Add appropriate ARIA attributes\n   - Ensure keyboard navigation works properly\n   - Provide alternative text for images\n\n9. Implement error handling:\n   - Handle network errors gracefully\n   - Display user-friendly error messages\n   - Provide options to retry or refresh\n\n10. Add smooth animations and transitions:\n    - Fade in/out effects for loading states\n    - Smooth sliding animations for autocomplete suggestions\n    - Subtle hover and click animations for interactive elements\n</thinking>\n\n<html>\n<head>\n  <title>Google Search</title>\n  <link rel=\"icon\" href=\"https://www.google.com/favicon.ico\" type=\"image/x-icon\">\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap\" rel=\"stylesheet\">\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\">\n  <script src=\"https://code.jquery.com/jquery-3.7.1.min.js\"></script>\n</head>\n<body class=\"font-roboto\">\n\n<div class=\"flex flex-col min-h-screen\">\n  <header class=\"flex items-center justify-end space-x-4 px-5 py-2 text-sm text-gray-700\">\n    <a href=\"#\" class=\"hover:underline\">About</a>\n    <a href=\"#\" class=\"hover:underline\">Store</a>\n    <a href=\"#\" class=\"hover:underline\">Gmail</a>\n    <a href=\"#\" class=\"hover:underline\">Images</a>\n    <img class=\"w-8 h-8 rounded-full\" src=\"https://via.placeholder.com/150\" alt=\"Profile picture of the user\">\n  </header>\n  \n  <div class=\"flex items-center justify-center flex-grow\">\n    <div class=\"flex flex-col items-center w-full max-w-[584px]\">\n      <img class=\"w-[272px] mb-8\" src=\"https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png\" alt=\"Google logo\">\n      <div class=\"relative w-full mb-3\">\n        <input type=\"text\" id=\"search\" class=\"w-full px-5 py-3 text-lg border border-gray-200 rounded-full hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500\" placeholder=\"Search Google or type a URL\" autocomplete=\"off\">\n        <div id=\"autocomplete\" class=\"absolute w-full bg-white border border-gray-100 rounded-md shadow-lg z-10 hidden\">\n          <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">times</div>\n          <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">ts-ebml</div>\n          <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">tiktok ceo</div>\n          <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">two videos</div>\n          <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">Taskrabbit</div>\n          <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">translate</div>\n          <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">Target</div>\n          <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">Taylor Swift</div>\n          <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">Travis Kelce</div>\n          <div class=\"px-4 py-2 hover:bg-gray-100 cursor-pointer\">Temu</div>\n        </div>\n      </div>\n      <div class=\"flex space-x-2\">\n        <button id=\"search-btn\" class=\"bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded\">Google Search</button>\n        <button class=\"bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded\">I'm Feeling Lucky</button>\n      </div>\n    </div>\n  </div>\n  \n  <div id=\"search-results\" class=\"flex-grow p-8 overflow-y-auto hidden\">\n    <div class=\"text-sm text-gray-600 mb-4\">Results for New York, NY 10022 - Choose area</div>\n    \n    <div class=\"bg-blue-50 p-4 mb-4\">\n      <button id=\"overview-btn\" class=\"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded\">Get an AI-powered overview for this search</button>\n    </div>\n    \n    <div id=\"results-list\">\n      <div class=\"mb-4\">\n        <div class=\"text-xl text-blue-800 mb-1\">\n          <a href=\"https://www.nytimes.com\">The New York Times</a>\n        </div>\n        <div class=\"text-sm text-gray-800 mb-1\">https://www.nytimes.com</div>\n        <div class=\"text-sm text-gray-600\">\n          The New York Times - Breaking News, US News, World News ...\n        </div>\n        <div class=\"text-sm text-gray-600\">  \n          Live news, investigations, opinion, photos and video by the journalists of The New York Times from more than 150 countries around the world.\n        </div>\n      </div>\n\n      <div class=\"mb-4\">\n        <div class=\"text-sm text-gray-600 mb-1\">Opinion | The House Vote to Force TikTok's Sale Is a Mistake - The ...</div>\n        <div class=\"text-sm text-gray-600\">Why Are Lawmakers Trying to Ban TikTok Instead of Doing What ...</div>\n      </div>\n\n      <div class=\"mb-4\">  \n        <div class=\"text-sm text-gray-600 mb-1\">The Crossword</div>\n        <div class=\"text-sm text-gray-600\">Play the Daily New York Times Crossword puzzle edited by Will ...</div>\n      </div>\n\n      <div class=\"mb-4\">\n        <div class=\"text-sm text-gray-600 mb-1\">Today's Paper</div>\n        <div class=\"text-sm text-gray-600\">Today's Paper \u00b7 The Front Page \u00b7 Highlights \u00b7 Lawyer, Author ...</div>\n      </div>\n\n      <div class=\"mb-4\">\n        <div class=\"text-sm text-gray-600 mb-1\">Word game Wordle</div>\n        <div class=\"text-sm text-gray-600\">Get 6 chances to guess a 5-letter word.Get 6 chances to guess a ...</div>\n      </div>\n\n      <div>\n        <div class=\"text-sm text-gray-600\">Connections</div>\n        <div class=\"text-sm text-gray-600\">A look at the links between The Times and the world it covers.</div>\n      </div>\n    </div>\n    \n    <div id=\"pagination\" class=\"flex justify-center mt-8\">\n      <button class=\"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mr-2\">Previous</button>\n      <button class=\"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded\">Next</button>\n    </div>\n  </div>\n  \n  <div id=\"overview\" class=\"flex-grow p-8 overflow-y-auto hidden\">\n    <h2 class=\"text-2xl font-medium mb-4\">The New York Times</h2>\n    <div class=\"mb-4\">\n      <div class=\"font-medium\">Newspaper</div>\n    </div>\n    <div class=\"mb-4\">  \n      <div class=\"font-medium\">Owner:</div>\n      <div>The New York Times Company</div>\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"font-medium\">Publisher:</div>  \n      <div>The New York Times Company</div>\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"font-medium\">Founders:</div>\n      <div>George Jones, Henry Jarvis Raymond</div>  \n    </div>\n    <div class=\"mb-4\">\n      <div class=\"font-medium\">Circulation:</div>\n      <div>10,360,000 news subscribers (as of February 2024)</div>\n    </div>\n    <div class=\"mb-4\">  \n      <div class=\"font-medium\">Editor-in-chief:</div>\n      <div>Joseph Kahn</div>\n    </div>\n    <div class=\"mb-4\">\n      <div class=\"font-medium\">Format:</div>\n      <div>Broadsheet</div>\n    </div>\n    <div>  \n      <div class=\"font-medium\">Founded:</div> \n      <div>September 18, 1851; 172 years ago</div>\n    </div>\n  </div>\n  \n  <footer class=\"bg-gray-100 text-sm text-gray-600 px-8 py-3\">\n    <div class=\"flex justify-between\">\n      <div class=\"flex space-x-6\">\n        <a href=\"#\" class=\"hover:underline\">Advertising</a>\n        <a href=\"#\" class=\"hover:underline\">Business</a>\n        <a href=\"#\" class=\"hover:underline\">How Search works</a>\n      </div>\n      <div class=\"flex space-x-6\">\n        <a href=\"#\" class=\"hover:underline\">Privacy</a>\n        <a href=\"#\" class=\"hover:underline\">Terms</a>\n        <a href=\"#\" class=\"hover:underline\">Settings</a>\n      </div>\n    </div>\n  </footer>\n</div>\n\n<script>\n$(document).ready(function() {\n  let selectedText = \"\";\n  \n  $(\"#search\").on(\"input\", function() {\n    const searchText = $(this).val().trim();\n    \n    if (searchText !== \"\") {\n      $(\"#autocomplete\").removeClass(\"hidden\");\n      $(\"#autocomplete div\").each(function() {\n        if ($(this).text().toLowerCase().includes(searchText.toLowerCase())) {\n          $(this).removeClass(\"hidden\");\n          $(this).html($(this).text().replace(new RegExp(searchText, \"gi\"), \"<strong>$&</strong>\"));\n        } else {\n          $(this).addClass(\"hidden\");\n        }\n      });\n    } else {\n      $(\"#autocomplete\").addClass(\"hidden\");\n    }\n  });\n  \n  $(\"#autocomplete div\").click(function() {\n    selectedText = $(this).text();\n    $(\"#search\").val(selectedText);\n    $(\"#autocomplete\").addClass(\"hidden\");\n  });\n  \n  $(\"#search\").keydown(function(e) {\n    if (e.which === 13) {\n      performSearch();\n    }\n  });\n  \n  $(\"#search-btn\").click(performSearch);\n  \n  $(\"#overview-btn\").click(function() {\n    $(\"#overview\").removeClass(\"hidden\");\n    $(\"#search-results\").addClass(\"hidden\");\n  });\n  \n  function performSearch() {\n    const query = $(\"#search\").val().trim();\n    if (query !== \"\") {\n      $(\"#search-results\").removeClass(\"hidden\");\n      $(\"#overview\").addClass(\"hidden\");\n      \n      // Simulating search results for demo purposes\n      $(\"#results-list\").empty();\n      for (let i = 0; i < 6; i++) {\n        $(\"#results-list\").append(`\n          <div class=\"mb-4\">\n            <div class=\"text-xl text-blue-800 mb-1\">\n              <a href=\"#\">Search Result ${i + 1}</a>\n            </div>\n            <div class=\"text-sm text-gray-800 mb-1\">https://example.com/result${i + 1}</div>\n            <div class=\"text-sm text-gray-600\">\n              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed euismod, nulla sit amet aliquam lacinia, nisl nisl aliquam nisl, nec aliquam nisl nisl sit amet nisl.\n            </div>\n          </div>\n        `);\n      }\n    }\n  }\n});\n</script>\n\n</body>\n</html>\n\"\"\"\n\nTALLY_FORM_VIDEO_PROMPT_MOCK = \"\"\"\n<thinking>\nThe user flow in the video seems to be:\n1. The quiz starts by asking \"What is the capital of Bulgaria?\" with three multiple choice options. The user selects \"Sofia\".\n2. The next question asks \"What is the most famous dish in Belgium?\" with two image-based options. The user selects \"Steak with fries\".\n3. The next question asks \"What is the name of this actor?\" with an image of an older man with gray hair and beard. The user types in \"Clooney\" and submits the answer.\n4. The quiz ends showing the user's score of 10/30 and a \"Bummer, try again!\" message with an arrow to restart.\n\nTo build this as a functional web app:\n1. Create the overall page structure with a title, question area, answer options area, and next/submit buttons.\n2. Use jQuery to show/hide different questions and update the answer options based on the current question. \n3. Store the questions, answer options, and correct answers in a Javascript array.\n4. Keep track of the user's selections and compare them to the correct answers to calculate the score.\n5. After the last question, show the final score and restart option.\n6. Style everything to match the screenshots using Tailwind utility classes.\n</thinking>\n\n<html>\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Online Trivia Quiz</title>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <script src=\"https://code.jquery.com/jquery-3.7.1.min.js\"></script>\n</head>\n<body class=\"bg-white text-gray-800 p-6\">\n  <h1 class=\"text-2xl font-bold mb-4\">Online Trivia Quiz</h1>\n  \n  <div id=\"question-container\" class=\"mb-6\">\n    <h2 id=\"question\" class=\"text-xl mb-4\"></h2>\n    <div id=\"options\" class=\"space-y-4\"></div>\n  </div>\n  \n  <div id=\"actor-container\" class=\"mb-6 hidden\">\n    <img id=\"actor-image\" src=\"\" alt=\"\" class=\"mb-4 w-2/3 mx-auto rounded-lg\">\n    <input type=\"text\" id=\"actor-answer\" class=\"border rounded w-full py-2 px-3 text-gray-700 mb-3\">\n  </div>\n\n  <div id=\"result-container\" class=\"text-center hidden\">\n    <h2 class=\"text-xl mb-2\">Bummer, try again!</h2>\n    <p id=\"score\" class=\"text-lg mb-4\"></p>\n    <button id=\"restart-btn\" class=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\">\n      <i class=\"fas fa-redo mr-2\"></i> Restart\n    </button>\n  </div>\n\n  <button id=\"next-btn\" class=\"bg-black hover:bg-gray-800 text-white font-bold py-2 px-4 rounded\">\n    Next <i class=\"fas fa-arrow-right ml-2\"></i>\n  </button>\n  \n  <button id=\"submit-btn\" class=\"bg-black hover:bg-gray-800 text-white font-bold py-2 px-4 rounded hidden\">\n    Submit <i class=\"fas fa-arrow-right ml-2\"></i>\n  </button>\n\n  <script>\n    const quizData = [\n      {\n        question: \"What is the capital of Bulgaria?\",\n        options: [\"Sofia\", \"Plovdiv\", \"Varna\"],\n        answer: \"Sofia\"\n      },\n      {\n        question: \"What is the most famous dish in Belgium?\", \n        options: [\n          {\n            image: \"https://via.placeholder.com/300x200?text=Spaghetti\",\n            alt: \"A bowl of spaghetti pasta with tomato sauce and parmesan cheese on top\",\n            text: \"Spaghetti\"\n          },\n          {\n            image: \"https://via.placeholder.com/300x200?text=Steak+with+fries\",\n            alt: \"A plate with grilled steak, french fries, and greens\",\n            text: \"Steak with fries\"\n          }\n        ],\n        answer: \"Steak with fries\"\n      },\n      {\n        question: \"What is the name of this actor?\",\n        image: \"https://via.placeholder.com/400x300?text=Older+man+with+gray+hair+and+beard\",\n        alt: \"Headshot of an older man with gray hair and a gray beard wearing a black suit and bowtie\",\n        answer: \"Clooney\"\n      }\n    ];\n\n    let currentQuestion = 0;\n    let score = 0;\n\n    function startQuiz() {\n      currentQuestion = 0;\n      score = 0;\n      $(\"#question-container\").show();\n      $(\"#actor-container\").hide();\n      $(\"#result-container\").hide();\n      $(\"#next-btn\").show();\n      $(\"#submit-btn\").hide();\n      showQuestion();\n    }\n\n    function showQuestion() {\n      const questionData = quizData[currentQuestion];\n      $(\"#question\").text(questionData.question);\n      \n      if (questionData.options) {\n        let optionsHtml = \"\";\n        for (let option of questionData.options) {\n          if (typeof option === \"string\") {\n            optionsHtml += `\n              <div>\n                <label>\n                  <input type=\"radio\" name=\"answer\" value=\"${option}\">\n                  ${option}\n                </label>\n              </div>\n            `;\n          } else {\n            optionsHtml += `\n              <div>\n                <label>\n                  <input type=\"radio\" name=\"answer\" value=\"${option.text}\">\n                  <img src=\"${option.image}\" alt=\"${option.alt}\" class=\"w-full mb-2\">\n                  ${option.text}\n                </label>\n              </div>\n            `;\n          }\n        }\n        $(\"#options\").html(optionsHtml);\n        $(\"#actor-container\").hide();\n      } else {\n        $(\"#options\").empty();\n        $(\"#actor-image\").attr(\"src\", questionData.image).attr(\"alt\", questionData.alt);\n        $(\"#actor-answer\").val(\"\");\n        $(\"#actor-container\").show();\n        $(\"#next-btn\").hide();\n        $(\"#submit-btn\").show();\n      }\n    }\n\n    function checkAnswer() {\n      const questionData = quizData[currentQuestion];\n      \n      let userAnswer;\n      if (questionData.options) {\n        userAnswer = $(\"input[name='answer']:checked\").val();\n      } else {\n        userAnswer = $(\"#actor-answer\").val().trim();\n      }\n\n      if (userAnswer === questionData.answer) {\n        score++;\n      }\n\n      currentQuestion++;\n      \n      if (currentQuestion < quizData.length) {\n        showQuestion();\n      } else {\n        showResult();\n      }\n    }\n\n    function showResult() {\n      $(\"#question-container\").hide();\n      $(\"#actor-container\").hide();\n      $(\"#score\").text(`Your score is: ${score} / ${quizData.length}`);\n      $(\"#result-container\").show();\n    }\n\n    $(\"#next-btn\").click(checkAnswer);\n    $(\"#submit-btn\").click(checkAnswer);\n    $(\"#restart-btn\").click(startQuiz);\n\n    startQuiz();\n  </script>\n</body>\n</html>\n</html>\n\nThis implements the online trivia quiz app as shown in the video. It uses jQuery to handle the interactions and Tailwind CSS for styling. The questions, options, and answers are defined in the quizData array. The app keeps track of the user's current question and score, allows selecting or entering answers, and displays the final score at the end with the option to restart.\n\n<thinking>\nTo further improve the app to match the original video:\n\n1. Adjust the styling to more closely match the font, colors, spacing, and layout in the screenshots. \n2. Add a cursor pointer when hovering over answer options.\n3. Improve the styling of the selected answer option.\n4. Make the \"Next\" button change to an arrow icon on hover.\n5. Add a \"Back\" button to go to the previous question.\n6. Show the current question number and total (e.g. \"Question 1 of 3\").\n7. Animate the transitions between questions.\n8. Improve the responsive layout for different screen sizes.\n9. Preload the images to avoid flickering.\n10. Refactor the code to be more modular and maintainable.\n</thinking>\n\n<html>\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Online Trivia Quiz</title>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <script src=\"https://code.jquery.com/jquery-3.7.1.min.js\"></script>\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\">\n  <style>\n    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');\n    body {\n      font-family: 'Roboto', sans-serif;\n    }\n    .option {\n      cursor: pointer;\n    }\n    .option.selected {\n      background-color: #EFF6FF;\n      border-color: #2563EB;\n    }\n    #next-btn:hover i {\n      transform: translateX(5px);\n    }\n  </style>\n</head>\n<body class=\"bg-white text-gray-800 p-6\">\n  <h1 class=\"text-3xl font-bold mb-8 text-center\">Online Trivia Quiz</h1>\n  \n  <div class=\"max-w-xl mx-auto\">\n    <div id=\"question-container\" class=\"mb-8\">\n      <div class=\"flex justify-between mb-4\">\n        <button id=\"back-btn\" class=\"text-blue-600 hover:text-blue-800 font-medium py-2 px-4 rounded\">\n          <i class=\"fas fa-arrow-left mr-2\"></i> Back\n        </button>\n        <span id=\"question-number\" class=\"text-lg font-medium\"></span>\n      </div>\n      <h2 id=\"question\" class=\"text-2xl font-medium mb-6\"></h2>\n      <div id=\"options\" class=\"space-y-4\"></div>\n    </div>\n    \n    <div id=\"actor-container\" class=\"mb-8 hidden\">\n      <img id=\"actor-image\" src=\"\" alt=\"\" class=\"mb-6 mx-auto rounded-lg\">\n      <input type=\"text\" id=\"actor-answer\" class=\"border border-gray-400 rounded w-full py-2 px-4 text-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-600\">\n    </div>\n\n    <div id=\"result-container\" class=\"text-center hidden\">\n      <h2 class=\"text-2xl font-medium mb-2\">Bummer, try again!</h2>\n      <p id=\"score\" class=\"text-xl mb-6\"></p>\n      <button id=\"restart-btn\" class=\"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded\">\n        <i class=\"fas fa-redo mr-2\"></i> Restart\n      </button>\n    </div>\n\n    <button id=\"next-btn\" class=\"bg-black hover:bg-gray-800 text-white font-medium py-2 px-4 rounded flex items-center ml-auto\">\n      Next <i class=\"fas fa-arrow-right ml-2\"></i>\n    </button>\n    \n    <button id=\"submit-btn\" class=\"bg-black hover:bg-gray-800 text-white font-medium py-2 px-4 rounded flex items-center ml-auto hidden\">\n      Submit <i class=\"fas fa-arrow-right ml-2\"></i>\n    </button>\n  </div>\n\n  <script>\n    const quizData = [\n      {\n        question: \"What is the capital of Bulgaria?\",\n        options: [\"Sofia\", \"Plovdiv\", \"Varna\"],\n        answer: \"Sofia\"\n      },\n      {\n        question: \"What is the most famous dish in Belgium?\", \n        options: [\n          {\n            image: \"https://sdxl-trainings.s3.amazonaws.com/DALL%C2%B7E+2024-03-08+12.29.30+-+A+bowl+of+spaghetti+pasta+with+tomato+sauce+and+parmesan+cheese+on+top%2C+set+on+a+rustic+wooden+table.+The+light+is+soft+and+warm%2C+enhancing+the+vibran.webp\",\n            alt: \"A bowl of spaghetti pasta with tomato sauce and parmesan cheese on top\",\n            text: \"Spaghetti\"\n          },\n          {\n            image: \"https://sdxl-trainings.s3.amazonaws.com/DALL%C2%B7E+2024-03-08+12.33.19+-+A+plate+with+grilled+steak%2C+french+fries%2C+and+greens%2C+presented+elegantly.+The+steak+is+perfectly+cooked+to+medium+rare%2C+showing+a+rich%2C+pink+center+a.webp\",\n            alt: \"A plate with grilled steak, french fries, and greens\",\n            text: \"Steak with fries\"\n          }\n        ],\n        answer: \"Steak with fries\"\n      },\n      {\n        question: \"What is the name of this actor?\",\n        image: \"https://sdxl-trainings.s3.amazonaws.com/DALL%C2%B7E+2024-03-08+12.34.00+-+Headshot+of+an+older+man+with+distinguished+gray+hair+and+a+neatly+trimmed+gray+beard%2C+conveying+a+sense+of+wisdom+and+experience.+He+is+wearing+a+cri.webp\",\n        alt: \"Headshot of an older man with gray hair and a gray beard wearing a black suit and bowtie\",\n        answer: \"Clooney\"\n      }\n    ];\n\n    let currentQuestion = 0;\n    let score = 0;\n\n    function startQuiz() {\n      currentQuestion = 0;\n      score = 0;\n      $(\"#question-container\").show();\n      $(\"#actor-container\").hide();\n      $(\"#result-container\").hide();\n      $(\"#next-btn\").show();\n      $(\"#submit-btn\").hide();\n      showQuestion();\n    }\n\n    function showQuestion() {\n      const questionData = quizData[currentQuestion];\n      $(\"#question\").text(questionData.question);\n      $(\"#question-number\").text(`Question ${currentQuestion + 1} of ${quizData.length}`);\n      \n      if (questionData.options) {\n        let optionsHtml = \"\";\n        for (let option of questionData.options) {\n          if (typeof option === \"string\") {\n            optionsHtml += `\n              <div class=\"option p-4 border border-gray-300 rounded flex items-center\">\n                <input type=\"radio\" name=\"answer\" id=\"${option}\" value=\"${option}\" class=\"mr-4\">\n                <label for=\"${option}\" class=\"text-lg font-medium flex-grow cursor-pointer\">${option}</label>\n              </div>\n            `;\n          } else {\n            optionsHtml += `\n              <div class=\"option p-4 border border-gray-300 rounded flex items-center\">\n                <input type=\"radio\" name=\"answer\" id=\"${option.text}\" value=\"${option.text}\" class=\"mr-4\">\n                <label for=\"${option.text}\" class=\"flex-grow cursor-pointer\">\n                  <img src=\"${option.image}\" alt=\"${option.alt}\" class=\"w-full mb-2 rounded\">\n                  <span class=\"text-lg font-medium\">${option.text}</span>\n                </label>\n              </div>\n            `;\n          }\n        }\n        $(\"#options\").html(optionsHtml);\n        $(\"#actor-container\").hide();\n      } else {\n        $(\"#options\").empty();\n        $(\"#actor-image\").attr(\"src\", questionData.image).attr(\"alt\", questionData.alt);\n        $(\"#actor-answer\").val(\"\");\n        $(\"#actor-container\").show();\n        $(\"#next-btn\").hide();\n        $(\"#submit-btn\").show();\n      }\n      \n      $(\"#back-btn\").toggle(currentQuestion > 0);\n    }\n\n    function checkAnswer() {\n      const questionData = quizData[currentQuestion];\n      \n      let userAnswer;\n      if (questionData.options) {\n        userAnswer = $(\"input[name='answer']:checked\").val();\n      } else {\n        userAnswer = $(\"#actor-answer\").val().trim();\n      }\n\n      if (userAnswer === questionData.answer) {\n        score++;\n      }\n\n      currentQuestion++;\n      \n      if (currentQuestion < quizData.length) {\n        $(\"#question-container\").fadeOut(200, function() {\n          showQuestion();\n          $(this).fadeIn(200);\n        });\n      } else {\n        $(\"#question-container\").fadeOut(200, function() {\n          showResult();\n          $(\"#result-container\").fadeIn(200);\n        });\n      }\n    }\n\n    function previousQuestion() {\n      if (currentQuestion > 0) {\n        currentQuestion--;\n        $(\"#question-container\").fadeOut(200, function() {\n          showQuestion();\n          $(this).fadeIn(200);\n        });\n      }\n    }\n\n    function showResult() {\n      $(\"#score\").text(`Your score is: ${score} / ${quizData.length}`);\n    }\n\n    $(\"#next-btn\").click(checkAnswer);\n    $(\"#submit-btn\").click(checkAnswer);\n    $(\"#back-btn\").click(previousQuestion);\n    $(\"#restart-btn\").click(function() {\n      $(\"#result-container\").fadeOut(200, function() {\n        startQuiz();\n        $(\"#question-container\").fadeIn(200);\n      });\n    });\n\n    $(\"body\").on(\"change\", \"input[name='answer']\", function() {\n      $(\".option\").removeClass(\"selected\");\n      $(this).closest(\".option\").addClass(\"selected\");\n    });\n\n    $(document).ready(function() {\n      // Preload images\n      let images = [];\n      for (let question of quizData) {\n        if (question.image) {\n          images.push(question.image);\n        } else if (question.options) {\n          for (let option of question.options) {\n            if (option.image) {\n              images.push(option.image);\n            }\n          }\n        }\n      }\n      preloadImages(images, startQuiz);\n    });\n\n    function preloadImages(urls, callback) {\n      let count = 0;\n      for (let url of urls) {\n        $(\"<img>\").attr(\"src\", url).on(\"load\", function() {\n          count++;\n          if (count === urls.length) {\n            callback();\n          }\n        });\n      }\n    }\n  </script>\n</body>\n</html>\n</html>\n\nThis updated version makes several improvements to match the original app more closely:\n\n1. Styling is refined to better match the font, colors, spacing, and layout of the screenshots.\n2. Cursor changes to a pointer when hovering over answer options.\n3. Selected answer option is highlighted.\n4. \"Next\" button shows an animated arrow on hover.\n5. \"Back\" button added to go to the previous question.\n6. Current question number and total are displayed.\n7. Fade transitions are added between questions.\n8. Layout is made responsive for different screen sizes.\n9. Images are preloaded to avoid flickering.\n10. Code is refactored to be more modular and maintainable.\n\nThe app should now be fully functional and closely resemble the look and behavior of the original video. Let me know if you would like any further adjustments!\n\"\"\"\n", "backend/utils.py": "import copy\nimport json\nfrom typing import List\nfrom openai.types.chat import ChatCompletionMessageParam\n\n\ndef pprint_prompt(prompt_messages: List[ChatCompletionMessageParam]):\n    print(json.dumps(truncate_data_strings(prompt_messages), indent=4))\n\n\ndef truncate_data_strings(data: List[ChatCompletionMessageParam]):  # type: ignore\n    # Deep clone the data to avoid modifying the original object\n    cloned_data = copy.deepcopy(data)\n\n    if isinstance(cloned_data, dict):\n        for key, value in cloned_data.items():  # type: ignore\n            # Recursively call the function if the value is a dictionary or a list\n            if isinstance(value, (dict, list)):\n                cloned_data[key] = truncate_data_strings(value)  # type: ignore\n            # Truncate the string if it it's long and add ellipsis and length\n            elif isinstance(value, str):\n                cloned_data[key] = value[:40]  # type: ignore\n                if len(value) > 40:\n                    cloned_data[key] += \"...\" + f\" ({len(value)} chars)\"  # type: ignore\n\n    elif isinstance(cloned_data, list):  # type: ignore\n        # Process each item in the list\n        cloned_data = [truncate_data_strings(item) for item in cloned_data]  # type: ignore\n\n    return cloned_data  # type: ignore\n", "backend/image_generation.py": "import asyncio\nimport re\nfrom typing import Dict, List, Union\nfrom openai import AsyncOpenAI\nfrom bs4 import BeautifulSoup\n\n\nasync def process_tasks(prompts: List[str], api_key: str, base_url: str | None):\n    tasks = [generate_image(prompt, api_key, base_url) for prompt in prompts]\n    results = await asyncio.gather(*tasks, return_exceptions=True)\n\n    processed_results: List[Union[str, None]] = []\n    for result in results:\n        if isinstance(result, Exception):\n            print(f\"An exception occurred: {result}\")\n            processed_results.append(None)\n        else:\n            processed_results.append(result)\n\n    return processed_results\n\n\nasync def generate_image(\n    prompt: str, api_key: str, base_url: str | None\n) -> Union[str, None]:\n    client = AsyncOpenAI(api_key=api_key, base_url=base_url)\n    res = await client.images.generate(\n        model=\"dall-e-3\",\n        quality=\"standard\",\n        style=\"natural\",\n        n=1,\n        size=\"1024x1024\",\n        prompt=prompt,\n    )\n    await client.close()\n    return res.data[0].url\n\n\ndef extract_dimensions(url: str):\n    # Regular expression to match numbers in the format '300x200'\n    matches = re.findall(r\"(\\d+)x(\\d+)\", url)\n\n    if matches:\n        width, height = matches[0]  # Extract the first match\n        width = int(width)\n        height = int(height)\n        return (width, height)\n    else:\n        return (100, 100)\n\n\ndef create_alt_url_mapping(code: str) -> Dict[str, str]:\n    soup = BeautifulSoup(code, \"html.parser\")\n    images = soup.find_all(\"img\")\n\n    mapping: Dict[str, str] = {}\n\n    for image in images:\n        if not image[\"src\"].startswith(\"https://placehold.co\"):\n            mapping[image[\"alt\"]] = image[\"src\"]\n\n    return mapping\n\n\nasync def generate_images(\n    code: str, api_key: str, base_url: Union[str, None], image_cache: Dict[str, str]\n) -> str:\n    # Find all images\n    soup = BeautifulSoup(code, \"html.parser\")\n    images = soup.find_all(\"img\")\n\n    # Extract alt texts as image prompts\n    alts: List[str | None] = []\n    for img in images:\n        # Only include URL if the image starts with https://placehold.co\n        # and it's not already in the image_cache\n        if (\n            img[\"src\"].startswith(\"https://placehold.co\")\n            and image_cache.get(img.get(\"alt\")) is None\n        ):\n            alts.append(img.get(\"alt\", None))\n\n    # Exclude images with no alt text\n    filtered_alts: List[str] = [alt for alt in alts if alt is not None]\n\n    # Remove duplicates\n    prompts = list(set(filtered_alts))\n\n    # Return early if there are no images to replace\n    if len(prompts) == 0:\n        return code\n\n    # Generate images\n    results = await process_tasks(prompts, api_key, base_url)\n\n    # Create a dict mapping alt text to image URL\n    mapped_image_urls = dict(zip(prompts, results))\n\n    # Merge with image_cache\n    mapped_image_urls = {**mapped_image_urls, **image_cache}\n\n    # Replace old image URLs with the generated URLs\n    for img in images:\n        # Skip images that don't start with https://placehold.co (leave them alone)\n        if not img[\"src\"].startswith(\"https://placehold.co\"):\n            continue\n\n        new_url = mapped_image_urls[img.get(\"alt\")]\n\n        if new_url:\n            # Set width and height attributes\n            width, height = extract_dimensions(img[\"src\"])\n            img[\"width\"] = width\n            img[\"height\"] = height\n            # Replace img['src'] with the mapped image URL\n            img[\"src\"] = new_url\n        else:\n            print(\"Image generation failed for alt text:\" + img.get(\"alt\"))\n\n    # Return the modified HTML\n    # (need to prettify it because BeautifulSoup messes up the formatting)\n    return soup.prettify()\n", "backend/llm.py": "from enum import Enum\nfrom typing import Any, Awaitable, Callable, List, cast\nfrom anthropic import AsyncAnthropic\nfrom openai import AsyncOpenAI\nfrom openai.types.chat import ChatCompletionMessageParam, ChatCompletionChunk\nfrom config import IS_DEBUG_ENABLED\nfrom debug.DebugFileWriter import DebugFileWriter\n\nfrom utils import pprint_prompt\n\n\n# Actual model versions that are passed to the LLMs and stored in our logs\nclass Llm(Enum):\n    GPT_4_VISION = \"gpt-4-vision-preview\"\n    GPT_4_TURBO_2024_04_09 = \"gpt-4-turbo-2024-04-09\"\n    GPT_4O_2024_05_13 = \"gpt-4o-2024-05-13\"\n    CLAUDE_3_SONNET = \"claude-3-sonnet-20240229\"\n    CLAUDE_3_OPUS = \"claude-3-opus-20240229\"\n    CLAUDE_3_HAIKU = \"claude-3-haiku-20240307\"\n    CLAUDE_3_5_SONNET_2024_06_20 = \"claude-3-5-sonnet-20240620\"\n\n\n# Will throw errors if you send a garbage string\ndef convert_frontend_str_to_llm(frontend_str: str) -> Llm:\n    if frontend_str == \"gpt_4_vision\":\n        return Llm.GPT_4_VISION\n    elif frontend_str == \"claude_3_sonnet\":\n        return Llm.CLAUDE_3_SONNET\n    else:\n        return Llm(frontend_str)\n\n\nasync def stream_openai_response(\n    messages: List[ChatCompletionMessageParam],\n    api_key: str,\n    base_url: str | None,\n    callback: Callable[[str], Awaitable[None]],\n    model: Llm,\n) -> str:\n    client = AsyncOpenAI(api_key=api_key, base_url=base_url)\n\n    # Base parameters\n    params = {\n        \"model\": model.value,\n        \"messages\": messages,\n        \"stream\": True,\n        \"timeout\": 600,\n        \"temperature\": 0.0,\n    }\n\n    # Add 'max_tokens' only if the model is a GPT4 vision or Turbo model\n    if (\n        model == Llm.GPT_4_VISION\n        or model == Llm.GPT_4_TURBO_2024_04_09\n        or model == Llm.GPT_4O_2024_05_13\n    ):\n        params[\"max_tokens\"] = 4096\n\n    stream = await client.chat.completions.create(**params)  # type: ignore\n    full_response = \"\"\n    async for chunk in stream:  # type: ignore\n        assert isinstance(chunk, ChatCompletionChunk)\n        if (\n            chunk.choices\n            and len(chunk.choices) > 0\n            and chunk.choices[0].delta\n            and chunk.choices[0].delta.content\n        ):\n            content = chunk.choices[0].delta.content or \"\"\n            full_response += content\n            await callback(content)\n\n    await client.close()\n\n    return full_response\n\n\n# TODO: Have a seperate function that translates OpenAI messages to Claude messages\nasync def stream_claude_response(\n    messages: List[ChatCompletionMessageParam],\n    api_key: str,\n    callback: Callable[[str], Awaitable[None]],\n    model: Llm,\n) -> str:\n\n    client = AsyncAnthropic(api_key=api_key)\n\n    # Base parameters\n    max_tokens = 4096\n    temperature = 0.0\n\n    # Translate OpenAI messages to Claude messages\n    system_prompt = cast(str, messages[0].get(\"content\"))\n    claude_messages = [dict(message) for message in messages[1:]]\n    for message in claude_messages:\n        if not isinstance(message[\"content\"], list):\n            continue\n\n        for content in message[\"content\"]:  # type: ignore\n            if content[\"type\"] == \"image_url\":\n                content[\"type\"] = \"image\"\n\n                # Extract base64 data and media type from data URL\n                # Example base64 data URL: data:image/png;base64,iVBOR...\n                image_data_url = cast(str, content[\"image_url\"][\"url\"])\n                media_type = image_data_url.split(\";\")[0].split(\":\")[1]\n                base64_data = image_data_url.split(\",\")[1]\n\n                # Remove OpenAI parameter\n                del content[\"image_url\"]\n\n                content[\"source\"] = {\n                    \"type\": \"base64\",\n                    \"media_type\": media_type,\n                    \"data\": base64_data,\n                }\n\n    # Stream Claude response\n    async with client.messages.stream(\n        model=model.value,\n        max_tokens=max_tokens,\n        temperature=temperature,\n        system=system_prompt,\n        messages=claude_messages,  # type: ignore\n    ) as stream:\n        async for text in stream.text_stream:\n            await callback(text)\n\n    # Return final message\n    response = await stream.get_final_message()\n\n    # Close the Anthropic client\n    await client.close()\n\n    return response.content[0].text\n\n\nasync def stream_claude_response_native(\n    system_prompt: str,\n    messages: list[Any],\n    api_key: str,\n    callback: Callable[[str], Awaitable[None]],\n    include_thinking: bool = False,\n    model: Llm = Llm.CLAUDE_3_OPUS,\n) -> str:\n\n    client = AsyncAnthropic(api_key=api_key)\n\n    # Base model parameters\n    max_tokens = 4096\n    temperature = 0.0\n\n    # Multi-pass flow\n    current_pass_num = 1\n    max_passes = 2\n\n    prefix = \"<thinking>\"\n    response = None\n\n    # For debugging\n    full_stream = \"\"\n    debug_file_writer = DebugFileWriter()\n\n    while current_pass_num <= max_passes:\n        current_pass_num += 1\n\n        # Set up message depending on whether we have a <thinking> prefix\n        messages_to_send = (\n            messages + [{\"role\": \"assistant\", \"content\": prefix}]\n            if include_thinking\n            else messages\n        )\n\n        pprint_prompt(messages_to_send)\n\n        async with client.messages.stream(\n            model=model.value,\n            max_tokens=max_tokens,\n            temperature=temperature,\n            system=system_prompt,\n            messages=messages_to_send,  # type: ignore\n        ) as stream:\n            async for text in stream.text_stream:\n                print(text, end=\"\", flush=True)\n                full_stream += text\n                await callback(text)\n\n        response = await stream.get_final_message()\n        response_text = response.content[0].text\n\n        # Write each pass's code to .html file and thinking to .txt file\n        if IS_DEBUG_ENABLED:\n            debug_file_writer.write_to_file(\n                f\"pass_{current_pass_num - 1}.html\",\n                debug_file_writer.extract_html_content(response_text),\n            )\n            debug_file_writer.write_to_file(\n                f\"thinking_pass_{current_pass_num - 1}.txt\",\n                response_text.split(\"</thinking>\")[0],\n            )\n\n        # Set up messages array for next pass\n        messages += [\n            {\"role\": \"assistant\", \"content\": str(prefix) + response.content[0].text},\n            {\n                \"role\": \"user\",\n                \"content\": \"You've done a good job with a first draft. Improve this further based on the original instructions so that the app is fully functional and looks like the original video of the app we're trying to replicate.\",\n            },\n        ]\n\n        print(\n            f\"Token usage: Input Tokens: {response.usage.input_tokens}, Output Tokens: {response.usage.output_tokens}\"\n        )\n\n    # Close the Anthropic client\n    await client.close()\n\n    if IS_DEBUG_ENABLED:\n        debug_file_writer.write_to_file(\"full_stream.txt\", full_stream)\n\n    if not response:\n        raise Exception(\"No HTML response found in AI response\")\n    else:\n        return response.content[0].text\n", "backend/main.py": "# Load environment variables first\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom routes import screenshot, generate_code, home, evals\n\napp = FastAPI(openapi_url=None, docs_url=None, redoc_url=None)\n\n# Configure CORS settings\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Add routes\napp.include_router(generate_code.router)\napp.include_router(screenshot.router)\napp.include_router(home.router)\napp.include_router(evals.router)\n", "backend/custom_types.py": "from typing import Literal\n\n\nInputMode = Literal[\n    \"image\",\n    \"video\",\n]\n", "backend/start.py": "import uvicorn\n\nif __name__ == \"__main__\":\n    uvicorn.run(\"main:app\", port=7001, reload=True)\n", "backend/routes/evals.py": "import os\nfrom fastapi import APIRouter\nfrom pydantic import BaseModel\nfrom evals.utils import image_to_data_url\nfrom evals.config import EVALS_DIR\n\n\nrouter = APIRouter()\n\n# Update this if the number of outputs generated per input changes\nN = 1\n\n\nclass Eval(BaseModel):\n    input: str\n    outputs: list[str]\n\n\n@router.get(\"/evals\")\nasync def get_evals():\n    # Get all evals from EVALS_DIR\n    input_dir = EVALS_DIR + \"/inputs\"\n    output_dir = EVALS_DIR + \"/outputs\"\n\n    evals: list[Eval] = []\n    for file in os.listdir(input_dir):\n        if file.endswith(\".png\"):\n            input_file_path = os.path.join(input_dir, file)\n            input_file = await image_to_data_url(input_file_path)\n\n            # Construct the corresponding output file names\n            output_file_names = [\n                file.replace(\".png\", f\"_{i}.html\") for i in range(0, N)\n            ]  # Assuming 3 outputs for each input\n\n            output_files_data: list[str] = []\n            for output_file_name in output_file_names:\n                output_file_path = os.path.join(output_dir, output_file_name)\n                # Check if the output file exists\n                if os.path.exists(output_file_path):\n                    with open(output_file_path, \"r\") as f:\n                        output_files_data.append(f.read())\n                else:\n                    output_files_data.append(\n                        \"<html><h1>Output file not found.</h1></html>\"\n                    )\n\n            evals.append(\n                Eval(\n                    input=input_file,\n                    outputs=output_files_data,\n                )\n            )\n\n    return evals\n", "backend/routes/screenshot.py": "import base64\nfrom fastapi import APIRouter\nfrom pydantic import BaseModel\nimport httpx\n\nrouter = APIRouter()\n\n\ndef bytes_to_data_url(image_bytes: bytes, mime_type: str) -> str:\n    base64_image = base64.b64encode(image_bytes).decode(\"utf-8\")\n    return f\"data:{mime_type};base64,{base64_image}\"\n\n\nasync def capture_screenshot(\n    target_url: str, api_key: str, device: str = \"desktop\"\n) -> bytes:\n    api_base_url = \"https://api.screenshotone.com/take\"\n\n    params = {\n        \"access_key\": api_key,\n        \"url\": target_url,\n        \"full_page\": \"true\",\n        \"device_scale_factor\": \"1\",\n        \"format\": \"png\",\n        \"block_ads\": \"true\",\n        \"block_cookie_banners\": \"true\",\n        \"block_trackers\": \"true\",\n        \"cache\": \"false\",\n        \"viewport_width\": \"342\",\n        \"viewport_height\": \"684\",\n    }\n\n    if device == \"desktop\":\n        params[\"viewport_width\"] = \"1280\"\n        params[\"viewport_height\"] = \"832\"\n\n    async with httpx.AsyncClient(timeout=60) as client:\n        response = await client.get(api_base_url, params=params)\n        if response.status_code == 200 and response.content:\n            return response.content\n        else:\n            raise Exception(\"Error taking screenshot\")\n\n\nclass ScreenshotRequest(BaseModel):\n    url: str\n    apiKey: str\n\n\nclass ScreenshotResponse(BaseModel):\n    url: str\n\n\n@router.post(\"/api/screenshot\")\nasync def app_screenshot(request: ScreenshotRequest):\n    # Extract the URL from the request body\n    url = request.url\n    api_key = request.apiKey\n\n    # TODO: Add error handling\n    image_bytes = await capture_screenshot(url, api_key=api_key)\n\n    # Convert the image bytes to a data url\n    data_url = bytes_to_data_url(image_bytes, \"image/png\")\n\n    return ScreenshotResponse(url=data_url)\n", "backend/routes/generate_code.py": "import os\nimport traceback\nfrom fastapi import APIRouter, WebSocket\nimport openai\nfrom config import ANTHROPIC_API_KEY, IS_PROD, SHOULD_MOCK_AI_RESPONSE\nfrom custom_types import InputMode\nfrom llm import (\n    Llm,\n    convert_frontend_str_to_llm,\n    stream_claude_response,\n    stream_claude_response_native,\n    stream_openai_response,\n)\nfrom openai.types.chat import ChatCompletionMessageParam\nfrom mock_llm import mock_completion\nfrom typing import Dict, List, Union, cast, get_args\nfrom image_generation import create_alt_url_mapping, generate_images\nfrom prompts import assemble_imported_code_prompt, assemble_prompt\nfrom datetime import datetime\nimport json\nfrom prompts.claude_prompts import VIDEO_PROMPT\nfrom prompts.types import Stack\n\n# from utils import pprint_prompt\nfrom video.utils import extract_tag_content, assemble_claude_prompt_video\nfrom ws.constants import APP_ERROR_WEB_SOCKET_CODE  # type: ignore\n\n\nrouter = APIRouter()\n\n\ndef write_logs(prompt_messages: List[ChatCompletionMessageParam], completion: str):\n    # Get the logs path from environment, default to the current working directory\n    logs_path = os.environ.get(\"LOGS_PATH\", os.getcwd())\n\n    # Create run_logs directory if it doesn't exist within the specified logs path\n    logs_directory = os.path.join(logs_path, \"run_logs\")\n    if not os.path.exists(logs_directory):\n        os.makedirs(logs_directory)\n\n    print(\"Writing to logs directory:\", logs_directory)\n\n    # Generate a unique filename using the current timestamp within the logs directory\n    filename = datetime.now().strftime(f\"{logs_directory}/messages_%Y%m%d_%H%M%S.json\")\n\n    # Write the messages dict into a new file for each run\n    with open(filename, \"w\") as f:\n        f.write(json.dumps({\"prompt\": prompt_messages, \"completion\": completion}))\n\n\n@router.websocket(\"/generate-code\")\nasync def stream_code(websocket: WebSocket):\n    await websocket.accept()\n\n    print(\"Incoming websocket connection...\")\n\n    async def throw_error(\n        message: str,\n    ):\n        await websocket.send_json({\"type\": \"error\", \"value\": message})\n        await websocket.close(APP_ERROR_WEB_SOCKET_CODE)\n\n    # TODO: Are the values always strings?\n    params: Dict[str, str] = await websocket.receive_json()\n\n    print(\"Received params\")\n\n    # Read the code config settings from the request. Fall back to default if not provided.\n    generated_code_config = \"\"\n    if \"generatedCodeConfig\" in params and params[\"generatedCodeConfig\"]:\n        generated_code_config = params[\"generatedCodeConfig\"]\n    if not generated_code_config in get_args(Stack):\n        await throw_error(f\"Invalid generated code config: {generated_code_config}\")\n        return\n    # Cast the variable to the Stack type\n    valid_stack = cast(Stack, generated_code_config)\n\n    # Validate the input mode\n    input_mode = params.get(\"inputMode\")\n    if not input_mode in get_args(InputMode):\n        await throw_error(f\"Invalid input mode: {input_mode}\")\n        raise Exception(f\"Invalid input mode: {input_mode}\")\n    # Cast the variable to the right type\n    validated_input_mode = cast(InputMode, input_mode)\n\n    # Read the model from the request. Fall back to default if not provided.\n    code_generation_model_str = params.get(\n        \"codeGenerationModel\", Llm.GPT_4O_2024_05_13.value\n    )\n    try:\n        code_generation_model = convert_frontend_str_to_llm(code_generation_model_str)\n    except:\n        await throw_error(f\"Invalid model: {code_generation_model_str}\")\n        raise Exception(f\"Invalid model: {code_generation_model_str}\")\n    exact_llm_version = None\n\n    print(\n        f\"Generating {generated_code_config} code for uploaded {input_mode} using {code_generation_model} model...\"\n    )\n\n    # Get the OpenAI API key from the request. Fall back to environment variable if not provided.\n    # If neither is provided, we throw an error.\n    openai_api_key = None\n    if params[\"openAiApiKey\"]:\n        openai_api_key = params[\"openAiApiKey\"]\n        print(\"Using OpenAI API key from client-side settings dialog\")\n    else:\n        openai_api_key = os.environ.get(\"OPENAI_API_KEY\")\n        if openai_api_key:\n            print(\"Using OpenAI API key from environment variable\")\n\n    if not openai_api_key and (\n        code_generation_model == Llm.GPT_4_VISION\n        or code_generation_model == Llm.GPT_4_TURBO_2024_04_09\n        or code_generation_model == Llm.GPT_4O_2024_05_13\n    ):\n        print(\"OpenAI API key not found\")\n        await throw_error(\n            \"No OpenAI API key found. Please add your API key in the settings dialog or add it to backend/.env file. If you add it to .env, make sure to restart the backend server.\"\n        )\n        return\n\n    # Get the Anthropic API key from the request. Fall back to environment variable if not provided.\n    # If neither is provided, we throw an error later only if Claude is used.\n    anthropic_api_key = None\n    if \"anthropicApiKey\" in params and params[\"anthropicApiKey\"]:\n        anthropic_api_key = params[\"anthropicApiKey\"]\n        print(\"Using Anthropic API key from client-side settings dialog\")\n    else:\n        anthropic_api_key = ANTHROPIC_API_KEY\n        if anthropic_api_key:\n            print(\"Using Anthropic API key from environment variable\")\n\n    # Get the OpenAI Base URL from the request. Fall back to environment variable if not provided.\n    openai_base_url: Union[str, None] = None\n    # Disable user-specified OpenAI Base URL in prod\n    if not os.environ.get(\"IS_PROD\"):\n        if \"openAiBaseURL\" in params and params[\"openAiBaseURL\"]:\n            openai_base_url = params[\"openAiBaseURL\"]\n            print(\"Using OpenAI Base URL from client-side settings dialog\")\n        else:\n            openai_base_url = os.environ.get(\"OPENAI_BASE_URL\")\n            if openai_base_url:\n                print(\"Using OpenAI Base URL from environment variable\")\n\n    if not openai_base_url:\n        print(\"Using official OpenAI URL\")\n\n    # Get the image generation flag from the request. Fall back to True if not provided.\n    should_generate_images = (\n        params[\"isImageGenerationEnabled\"]\n        if \"isImageGenerationEnabled\" in params\n        else True\n    )\n\n    print(\"generating code...\")\n    await websocket.send_json({\"type\": \"status\", \"value\": \"Generating code...\"})\n\n    async def process_chunk(content: str):\n        await websocket.send_json({\"type\": \"chunk\", \"value\": content})\n\n    # Image cache for updates so that we don't have to regenerate images\n    image_cache: Dict[str, str] = {}\n\n    # If this generation started off with imported code, we need to assemble the prompt differently\n    if params.get(\"isImportedFromCode\") and params[\"isImportedFromCode\"]:\n        original_imported_code = params[\"history\"][0]\n        prompt_messages = assemble_imported_code_prompt(\n            original_imported_code, valid_stack\n        )\n        for index, text in enumerate(params[\"history\"][1:]):\n            if index % 2 == 0:\n                message: ChatCompletionMessageParam = {\n                    \"role\": \"user\",\n                    \"content\": text,\n                }\n            else:\n                message: ChatCompletionMessageParam = {\n                    \"role\": \"assistant\",\n                    \"content\": text,\n                }\n            prompt_messages.append(message)\n    else:\n        # Assemble the prompt\n        try:\n            if params.get(\"resultImage\") and params[\"resultImage\"]:\n                prompt_messages = assemble_prompt(\n                    params[\"image\"], valid_stack, params[\"resultImage\"]\n                )\n            else:\n                prompt_messages = assemble_prompt(params[\"image\"], valid_stack)\n        except:\n            await websocket.send_json(\n                {\n                    \"type\": \"error\",\n                    \"value\": \"Error assembling prompt. Contact support at support@picoapps.xyz\",\n                }\n            )\n            await websocket.close()\n            return\n\n        if params[\"generationType\"] == \"update\":\n            # Transform the history tree into message format\n            # TODO: Move this to frontend\n            for index, text in enumerate(params[\"history\"]):\n                if index % 2 == 0:\n                    message: ChatCompletionMessageParam = {\n                        \"role\": \"assistant\",\n                        \"content\": text,\n                    }\n                else:\n                    message: ChatCompletionMessageParam = {\n                        \"role\": \"user\",\n                        \"content\": text,\n                    }\n                prompt_messages.append(message)\n\n            image_cache = create_alt_url_mapping(params[\"history\"][-2])\n\n    if validated_input_mode == \"video\":\n        video_data_url = params[\"image\"]\n        prompt_messages = await assemble_claude_prompt_video(video_data_url)\n\n    # pprint_prompt(prompt_messages)  # type: ignore\n\n    if SHOULD_MOCK_AI_RESPONSE:\n        completion = await mock_completion(\n            process_chunk, input_mode=validated_input_mode\n        )\n    else:\n        try:\n            if validated_input_mode == \"video\":\n                if not anthropic_api_key:\n                    await throw_error(\n                        \"Video only works with Anthropic models. No Anthropic API key found. Please add the environment variable ANTHROPIC_API_KEY to backend/.env or in the settings dialog\"\n                    )\n                    raise Exception(\"No Anthropic key\")\n\n                completion = await stream_claude_response_native(\n                    system_prompt=VIDEO_PROMPT,\n                    messages=prompt_messages,  # type: ignore\n                    api_key=anthropic_api_key,\n                    callback=lambda x: process_chunk(x),\n                    model=Llm.CLAUDE_3_OPUS,\n                    include_thinking=True,\n                )\n                exact_llm_version = Llm.CLAUDE_3_OPUS\n            elif (\n                code_generation_model == Llm.CLAUDE_3_SONNET\n                or code_generation_model == Llm.CLAUDE_3_5_SONNET_2024_06_20\n            ):\n                if not anthropic_api_key:\n                    await throw_error(\n                        \"No Anthropic API key found. Please add the environment variable ANTHROPIC_API_KEY to backend/.env or in the settings dialog\"\n                    )\n                    raise Exception(\"No Anthropic key\")\n\n                completion = await stream_claude_response(\n                    prompt_messages,  # type: ignore\n                    api_key=anthropic_api_key,\n                    callback=lambda x: process_chunk(x),\n                    model=code_generation_model,\n                )\n                exact_llm_version = code_generation_model\n            else:\n                completion = await stream_openai_response(\n                    prompt_messages,  # type: ignore\n                    api_key=openai_api_key,\n                    base_url=openai_base_url,\n                    callback=lambda x: process_chunk(x),\n                    model=code_generation_model,\n                )\n                exact_llm_version = code_generation_model\n        except openai.AuthenticationError as e:\n            print(\"[GENERATE_CODE] Authentication failed\", e)\n            error_message = (\n                \"Incorrect OpenAI key. Please make sure your OpenAI API key is correct, or create a new OpenAI API key on your OpenAI dashboard.\"\n                + (\n                    \" Alternatively, you can purchase code generation credits directly on this website.\"\n                    if IS_PROD\n                    else \"\"\n                )\n            )\n            return await throw_error(error_message)\n        except openai.NotFoundError as e:\n            print(\"[GENERATE_CODE] Model not found\", e)\n            error_message = (\n                e.message\n                + \". Please make sure you have followed the instructions correctly to obtain an OpenAI key with GPT vision access: https://github.com/abi/screenshot-to-code/blob/main/Troubleshooting.md\"\n                + (\n                    \" Alternatively, you can purchase code generation credits directly on this website.\"\n                    if IS_PROD\n                    else \"\"\n                )\n            )\n            return await throw_error(error_message)\n        except openai.RateLimitError as e:\n            print(\"[GENERATE_CODE] Rate limit exceeded\", e)\n            error_message = (\n                \"OpenAI error - 'You exceeded your current quota, please check your plan and billing details.'\"\n                + (\n                    \" Alternatively, you can purchase code generation credits directly on this website.\"\n                    if IS_PROD\n                    else \"\"\n                )\n            )\n            return await throw_error(error_message)\n\n    if validated_input_mode == \"video\":\n        completion = extract_tag_content(\"html\", completion)\n\n    print(\"Exact used model for generation: \", exact_llm_version)\n\n    # Write the messages dict into a log so that we can debug later\n    write_logs(prompt_messages, completion)  # type: ignore\n\n    try:\n        if should_generate_images:\n            await websocket.send_json(\n                {\"type\": \"status\", \"value\": \"Generating images...\"}\n            )\n            updated_html = await generate_images(\n                completion,\n                api_key=openai_api_key,\n                base_url=openai_base_url,\n                image_cache=image_cache,\n            )\n        else:\n            updated_html = completion\n        await websocket.send_json({\"type\": \"setCode\", \"value\": updated_html})\n        await websocket.send_json(\n            {\"type\": \"status\", \"value\": \"Code generation complete.\"}\n        )\n    except Exception as e:\n        traceback.print_exc()\n        print(\"Image generation failed\", e)\n        # Send set code even if image generation fails since that triggers\n        # the frontend to update history\n        await websocket.send_json({\"type\": \"setCode\", \"value\": completion})\n        await websocket.send_json(\n            {\"type\": \"status\", \"value\": \"Image generation failed but code is complete.\"}\n        )\n\n    await websocket.close()\n", "backend/routes/home.py": "from fastapi import APIRouter\nfrom fastapi.responses import HTMLResponse\n\n\nrouter = APIRouter()\n\n\n@router.get(\"/\")\nasync def get_status():\n    return HTMLResponse(\n        content=\"<h3>Your backend is running correctly. Please open the front-end URL (default is http://localhost:5173) to use screenshot-to-code.</h3>\"\n    )\n", "backend/evals/config.py": "EVALS_DIR = \"./evals_data\"\n", "backend/evals/core.py": "import os\nfrom config import ANTHROPIC_API_KEY\n\nfrom llm import Llm, stream_claude_response, stream_openai_response\nfrom prompts import assemble_prompt\nfrom prompts.types import Stack\n\n\nasync def generate_code_core(image_url: str, stack: Stack, model: Llm) -> str:\n    prompt_messages = assemble_prompt(image_url, stack)\n    openai_api_key = os.environ.get(\"OPENAI_API_KEY\")\n    anthropic_api_key = ANTHROPIC_API_KEY\n    openai_base_url = None\n\n    async def process_chunk(content: str):\n        pass\n\n    if model == Llm.CLAUDE_3_SONNET or model == Llm.CLAUDE_3_5_SONNET_2024_06_20:\n        if not anthropic_api_key:\n            raise Exception(\"Anthropic API key not found\")\n\n        completion = await stream_claude_response(\n            prompt_messages,\n            api_key=anthropic_api_key,\n            callback=lambda x: process_chunk(x),\n            model=model,\n        )\n    else:\n        if not openai_api_key:\n            raise Exception(\"OpenAI API key not found\")\n\n        completion = await stream_openai_response(\n            prompt_messages,\n            api_key=openai_api_key,\n            base_url=openai_base_url,\n            callback=lambda x: process_chunk(x),\n            model=model,\n        )\n\n    return completion\n", "backend/evals/utils.py": "import base64\n\n\nasync def image_to_data_url(filepath: str):\n    with open(filepath, \"rb\") as image_file:\n        encoded_string = base64.b64encode(image_file.read()).decode()\n    return f\"data:image/png;base64,{encoded_string}\"\n", "backend/evals/__init__.py": "", "backend/debug/DebugFileWriter.py": "import os\nimport logging\nimport uuid\n\nfrom config import DEBUG_DIR, IS_DEBUG_ENABLED\n\n\nclass DebugFileWriter:\n    def __init__(self):\n        if not IS_DEBUG_ENABLED:\n            return\n\n        try:\n            self.debug_artifacts_path = os.path.expanduser(\n                f\"{DEBUG_DIR}/{str(uuid.uuid4())}\"\n            )\n            os.makedirs(self.debug_artifacts_path, exist_ok=True)\n            print(f\"Debugging artifacts will be stored in: {self.debug_artifacts_path}\")\n        except:\n            logging.error(\"Failed to create debug directory\")\n\n    def write_to_file(self, filename: str, content: str) -> None:\n        try:\n            with open(os.path.join(self.debug_artifacts_path, filename), \"w\") as file:\n                file.write(content)\n        except Exception as e:\n            logging.error(f\"Failed to write to file: {e}\")\n\n    def extract_html_content(self, text: str) -> str:\n        return str(text.split(\"<html>\")[-1].rsplit(\"</html>\", 1)[0] + \"</html>\")\n", "backend/debug/__init__.py": "", "backend/prompts/screenshot_system_prompts.py": "from prompts.types import SystemPrompts\n\n\nHTML_TAILWIND_SYSTEM_PROMPT = \"\"\"\nYou are an expert Tailwind developer\nYou take screenshots of a reference web page from the user, and then build single page apps \nusing Tailwind, HTML and JS.\nYou might also be given a screenshot(The second image) of a web page that you have already built, and asked to\nupdate it to look more like the reference image(The first image).\n\n- Make sure the app looks exactly like the screenshot.\n- Pay close attention to background color, text color, font size, font family, \npadding, margin, border, etc. Match the colors and sizes exactly.\n- Use the exact text from the screenshot.\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed to match the screenshot. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\n\"\"\"\n\nBOOTSTRAP_SYSTEM_PROMPT = \"\"\"\nYou are an expert Bootstrap developer\nYou take screenshots of a reference web page from the user, and then build single page apps \nusing Bootstrap, HTML and JS.\nYou might also be given a screenshot(The second image) of a web page that you have already built, and asked to\nupdate it to look more like the reference image(The first image).\n\n- Make sure the app looks exactly like the screenshot.\n- Pay close attention to background color, text color, font size, font family, \npadding, margin, border, etc. Match the colors and sizes exactly.\n- Use the exact text from the screenshot.\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed to match the screenshot. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use this script to include Bootstrap: <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\" integrity=\"sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN\" crossorigin=\"anonymous\">\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\n\"\"\"\n\nREACT_TAILWIND_SYSTEM_PROMPT = \"\"\"\nYou are an expert React/Tailwind developer\nYou take screenshots of a reference web page from the user, and then build single page apps \nusing React and Tailwind CSS.\nYou might also be given a screenshot(The second image) of a web page that you have already built, and asked to\nupdate it to look more like the reference image(The first image).\n\n- Make sure the app looks exactly like the screenshot.\n- Pay close attention to background color, text color, font size, font family, \npadding, margin, border, etc. Match the colors and sizes exactly.\n- Use the exact text from the screenshot.\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed to match the screenshot. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use these script to include React so that it can run on a standalone page:\n    <script src=\"https://unpkg.com/react/umd/react.development.js\"></script>\n    <script src=\"https://unpkg.com/react-dom/umd/react-dom.development.js\"></script>\n    <script src=\"https://unpkg.com/@babel/standalone/babel.js\"></script>\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\n\"\"\"\n\nIONIC_TAILWIND_SYSTEM_PROMPT = \"\"\"\nYou are an expert Ionic/Tailwind developer\nYou take screenshots of a reference web page from the user, and then build single page apps \nusing Ionic and Tailwind CSS.\nYou might also be given a screenshot(The second image) of a web page that you have already built, and asked to\nupdate it to look more like the reference image(The first image).\n\n- Make sure the app looks exactly like the screenshot.\n- Pay close attention to background color, text color, font size, font family, \npadding, margin, border, etc. Match the colors and sizes exactly.\n- Use the exact text from the screenshot.\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed to match the screenshot. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use these script to include Ionic so that it can run on a standalone page:\n    <script type=\"module\" src=\"https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js\"></script>\n    <script nomodule src=\"https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js\"></script>\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css\" />\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- ionicons for icons, add the following <script > tags near the end of the page, right before the closing </body> tag:\n    <script type=\"module\">\n        import ionicons from 'https://cdn.jsdelivr.net/npm/ionicons/+esm'\n    </script>\n    <script nomodule src=\"https://cdn.jsdelivr.net/npm/ionicons/dist/esm/ionicons.min.js\"></script>\n    <link href=\"https://cdn.jsdelivr.net/npm/ionicons/dist/collection/components/icon/icon.min.css\" rel=\"stylesheet\">\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\n\"\"\"\n\nVUE_TAILWIND_SYSTEM_PROMPT = \"\"\"\nYou are an expert Vue/Tailwind developer\nYou take screenshots of a reference web page from the user, and then build single page apps \nusing Vue and Tailwind CSS.\nYou might also be given a screenshot(The second image) of a web page that you have already built, and asked to\nupdate it to look more like the reference image(The first image).\n\n- Make sure the app looks exactly like the screenshot.\n- Pay close attention to background color, text color, font size, font family, \npadding, margin, border, etc. Match the colors and sizes exactly.\n- Use the exact text from the screenshot.\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed to match the screenshot. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n- Use Vue using the global build like so:\n\n<div id=\"app\">{{ message }}</div>\n<script>\n  const { createApp, ref } = Vue\n  createApp({\n    setup() {\n      const message = ref('Hello vue!')\n      return {\n        message\n      }\n    }\n  }).mount('#app')\n</script>\n\nIn terms of libraries,\n\n- Use these script to include Vue so that it can run on a standalone page:\n  <script src=\"https://registry.npmmirror.com/vue/3.3.11/files/dist/vue.global.js\"></script>\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\nThe return result must only include the code.\n\"\"\"\n\n\nSVG_SYSTEM_PROMPT = \"\"\"\nYou are an expert at building SVGs.\nYou take screenshots of a reference web page from the user, and then build a SVG that looks exactly like the screenshot.\n\n- Make sure the SVG looks exactly like the screenshot.\n- Pay close attention to background color, text color, font size, font family, \npadding, margin, border, etc. Match the colors and sizes exactly.\n- Use the exact text from the screenshot.\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed to match the screenshot. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n- You can use Google Fonts\n\nReturn only the full code in <svg></svg> tags.\nDo not include markdown \"```\" or \"```svg\" at the start or end.\n\"\"\"\n\n\nSYSTEM_PROMPTS = SystemPrompts(\n    html_tailwind=HTML_TAILWIND_SYSTEM_PROMPT,\n    react_tailwind=REACT_TAILWIND_SYSTEM_PROMPT,\n    bootstrap=BOOTSTRAP_SYSTEM_PROMPT,\n    ionic_tailwind=IONIC_TAILWIND_SYSTEM_PROMPT,\n    vue_tailwind=VUE_TAILWIND_SYSTEM_PROMPT,\n    svg=SVG_SYSTEM_PROMPT,\n)\n", "backend/prompts/types.py": "from typing import Literal, TypedDict\n\n\nclass SystemPrompts(TypedDict):\n    html_tailwind: str\n    react_tailwind: str\n    bootstrap: str\n    ionic_tailwind: str\n    vue_tailwind: str\n    svg: str\n\n\nStack = Literal[\n    \"html_tailwind\",\n    \"react_tailwind\",\n    \"bootstrap\",\n    \"ionic_tailwind\",\n    \"vue_tailwind\",\n    \"svg\",\n]\n", "backend/prompts/claude_prompts.py": "# Not used yet\n# References:\n# https://github.com/hundredblocks/transcription_demo\n# https://docs.anthropic.com/claude/docs/prompt-engineering\n# https://github.com/anthropics/anthropic-cookbook/blob/main/multimodal/best_practices_for_vision.ipynb\n\nVIDEO_PROMPT = \"\"\"\nYou are an expert at building single page, funtional apps using HTML, Jquery and Tailwind CSS.\nYou also have perfect vision and pay great attention to detail.\n\nYou will be given screenshots in order at consistent intervals from a video of a user interacting with a web app. You need to re-create the same app exactly such that the same user interactions will produce the same results in the app you build.\n\n- Make sure the app looks exactly like the screenshot.\n- Pay close attention to background color, text color, font size, font family, \npadding, margin, border, etc. Match the colors and sizes exactly.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n- If some fuctionality requires a backend call, just mock the data instead.\n- MAKE THE APP FUNCTIONAL using Javascript. Allow the user to interact with the app and get the same behavior as the video.\n\nIn terms of libraries,\n\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n- Use jQuery: <script src=\"https://code.jquery.com/jquery-3.7.1.min.js\"></script>\n\nBefore generating the code for the app, think step-by-step: first, about the user flow depicated in the video and then about you how would you build it and how you would structure the code. Do the thinking within <thinking></thinking> tags. Then, provide your code within <html></html> tags.\n\"\"\"\n\nVIDEO_PROMPT_ALPINE_JS = \"\"\"\nYou are an expert at building single page, funtional apps using HTML, Alpine.js and Tailwind CSS.\nYou also have perfect vision and pay great attention to detail.\n\nYou will be given screenshots in order at consistent intervals from a video of a user interacting with a web app. You need to re-create the same app exactly such that the same user interactions will produce the same results in the app you build.\n\n- Make sure the app looks exactly like the screenshot.\n- Pay close attention to background color, text color, font size, font family, \npadding, margin, border, etc. Match the colors and sizes exactly.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n- If some fuctionality requires a backend call, just mock the data instead.\n- MAKE THE APP FUNCTIONAL using Javascript. Allow the user to interact with the app and get the same behavior as the video.\n\nIn terms of libraries,\n\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n- Use Alpine.js: <script defer src=\"https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js\"></script>\n\nBefore generating the code for the app, think step-by-step: first, about the user flow depicated in the video and then about you how would you build it and how you would structure the code. Do the thinking within <thinking></thinking> tags. Then, provide your code within <html></html> tags.\n\"\"\"\n\n\nHTML_TAILWIND_CLAUDE_SYSTEM_PROMPT = \"\"\"\nYou have perfect vision and pay great attention to detail which makes you an expert at building single page apps using Tailwind, HTML and JS.\nYou take screenshots of a reference web page from the user, and then build single page apps \nusing Tailwind, HTML and JS.\nYou might also be given a screenshot (The second image) of a web page that you have already built, and asked to\nupdate it to look more like the reference image(The first image).\n\n- Make sure the app looks exactly like the screenshot.\n- Do not leave out smaller UI elements. Make sure to include every single thing in the screenshot.\n- Pay close attention to background color, text color, font size, font family, \npadding, margin, border, etc. Match the colors and sizes exactly.\n- In particular, pay attention to background color and overall color scheme.\n- Use the exact text from the screenshot.\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Make sure to always get the layout right (if things are arranged in a row in the screenshot, they should be in a row in the app as well)\n- Repeat elements as needed to match the screenshot. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\n\"\"\"\n\n#\n\nREACT_TAILWIND_CLAUDE_SYSTEM_PROMPT = \"\"\"\nYou have perfect vision and pay great attention to detail which makes you an expert at building single page apps using React/Tailwind.\nYou take screenshots of a reference web page from the user, and then build single page apps \nusing React and Tailwind CSS.\nYou might also be given a screenshot (The second image) of a web page that you have already built, and asked to\nupdate it to look more like the reference image(The first image).\n\n- Make sure the app looks exactly like the screenshot.\n- Do not leave out smaller UI elements. Make sure to include every single thing in the screenshot.\n- Pay close attention to background color, text color, font size, font family, \npadding, margin, border, etc. Match the colors and sizes exactly.\n- In particular, pay attention to background color and overall color scheme.\n- Use the exact text from the screenshot.\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Make sure to always get the layout right (if things are arranged in a row in the screenshot, they should be in a row in the app as well)\n- CREATE REUSABLE COMPONENTS FOR REPEATING ELEMENTS. For example, if there are 15 similar items in the screenshot, your code should include a reusable component that generates these items. and use loops to instantiate these components as needed.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use these script to include React so that it can run on a standalone page:\n    <script src=\"https://unpkg.com/react/umd/react.development.js\"></script>\n    <script src=\"https://unpkg.com/react-dom/umd/react-dom.development.js\"></script>\n    <script src=\"https://unpkg.com/@babel/standalone/babel.js\"></script>\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\n\"\"\"\n", "backend/prompts/__init__.py": "from typing import List, NoReturn, Union\n\nfrom openai.types.chat import ChatCompletionMessageParam, ChatCompletionContentPartParam\n\nfrom prompts.imported_code_prompts import IMPORTED_CODE_SYSTEM_PROMPTS\nfrom prompts.screenshot_system_prompts import SYSTEM_PROMPTS\nfrom prompts.types import Stack\n\n\nUSER_PROMPT = \"\"\"\nGenerate code for a web page that looks exactly like this.\n\"\"\"\n\nSVG_USER_PROMPT = \"\"\"\nGenerate code for a SVG that looks exactly like this.\n\"\"\"\n\n\ndef assemble_imported_code_prompt(\n    code: str, stack: Stack, result_image_data_url: Union[str, None] = None\n) -> List[ChatCompletionMessageParam]:\n    system_content = IMPORTED_CODE_SYSTEM_PROMPTS[stack]\n\n    user_content = (\n        \"Here is the code of the app: \" + code\n        if stack != \"svg\"\n        else \"Here is the code of the SVG: \" + code\n    )\n    return [\n        {\n            \"role\": \"system\",\n            \"content\": system_content,\n        },\n        {\n            \"role\": \"user\",\n            \"content\": user_content,\n        },\n    ]\n    # TODO: Use result_image_data_url\n\n\ndef assemble_prompt(\n    image_data_url: str,\n    stack: Stack,\n    result_image_data_url: Union[str, None] = None,\n) -> List[ChatCompletionMessageParam]:\n    system_content = SYSTEM_PROMPTS[stack]\n    user_prompt = USER_PROMPT if stack != \"svg\" else SVG_USER_PROMPT\n\n    user_content: List[ChatCompletionContentPartParam] = [\n        {\n            \"type\": \"image_url\",\n            \"image_url\": {\"url\": image_data_url, \"detail\": \"high\"},\n        },\n        {\n            \"type\": \"text\",\n            \"text\": user_prompt,\n        },\n    ]\n\n    # Include the result image if it exists\n    if result_image_data_url:\n        user_content.insert(\n            1,\n            {\n                \"type\": \"image_url\",\n                \"image_url\": {\"url\": result_image_data_url, \"detail\": \"high\"},\n            },\n        )\n    return [\n        {\n            \"role\": \"system\",\n            \"content\": system_content,\n        },\n        {\n            \"role\": \"user\",\n            \"content\": user_content,\n        },\n    ]\n", "backend/prompts/imported_code_prompts.py": "from prompts.types import SystemPrompts\n\n\nIMPORTED_CODE_TAILWIND_SYSTEM_PROMPT = \"\"\"\nYou are an expert Tailwind developer.\n\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\n\"\"\"\n\nIMPORTED_CODE_REACT_TAILWIND_SYSTEM_PROMPT = \"\"\"\nYou are an expert React/Tailwind developer\n\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use these script to include React so that it can run on a standalone page:\n    <script src=\"https://unpkg.com/react/umd/react.development.js\"></script>\n    <script src=\"https://unpkg.com/react-dom/umd/react-dom.development.js\"></script>\n    <script src=\"https://unpkg.com/@babel/standalone/babel.js\"></script>\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\n\"\"\"\n\nIMPORTED_CODE_BOOTSTRAP_SYSTEM_PROMPT = \"\"\"\nYou are an expert Bootstrap developer.\n\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use this script to include Bootstrap: <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\" integrity=\"sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN\" crossorigin=\"anonymous\">\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\n\"\"\"\n\nIMPORTED_CODE_IONIC_TAILWIND_SYSTEM_PROMPT = \"\"\"\nYou are an expert Ionic/Tailwind developer.\n\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use these script to include Ionic so that it can run on a standalone page:\n    <script type=\"module\" src=\"https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js\"></script>\n    <script nomodule src=\"https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js\"></script>\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css\" />\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- ionicons for icons, add the following <script > tags near the end of the page, right before the closing </body> tag:\n    <script type=\"module\">\n        import ionicons from 'https://cdn.jsdelivr.net/npm/ionicons/+esm'\n    </script>\n    <script nomodule src=\"https://cdn.jsdelivr.net/npm/ionicons/dist/esm/ionicons.min.js\"></script>\n    <link href=\"https://cdn.jsdelivr.net/npm/ionicons/dist/collection/components/icon/icon.min.css\" rel=\"stylesheet\">\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\n\"\"\"\n\nIMPORTED_CODE_VUE_TAILWIND_SYSTEM_PROMPT = \"\"\"\nYou are an expert Vue/Tailwind developer.\n\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n\nIn terms of libraries,\n\n- Use these script to include Vue so that it can run on a standalone page:\n  <script src=\"https://registry.npmmirror.com/vue/3.3.11/files/dist/vue.global.js\"></script>\n- Use Vue using the global build like so:\n    <div id=\"app\">{{ message }}</div>\n    <script>\n    const { createApp, ref } = Vue\n    createApp({\n        setup() {\n        const message = ref('Hello vue!')\n        return {\n            message\n        }\n        }\n    }).mount('#app')\n    </script>\n- Use this script to include Tailwind: <script src=\"https://cdn.tailwindcss.com\"></script>\n- You can use Google Fonts\n- Font Awesome for icons: <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"></link>\n\nReturn only the full code in <html></html> tags.\nDo not include markdown \"```\" or \"```html\" at the start or end.\nThe return result must only include the code.\"\"\"\n\nIMPORTED_CODE_SVG_SYSTEM_PROMPT = \"\"\"\nYou are an expert at building SVGs.\n\n- Do not add comments in the code such as \"<!-- Add other navigation links as needed -->\" and \"<!-- ... other news items ... -->\" in place of writing the full code. WRITE THE FULL CODE.\n- Repeat elements as needed to match the screenshot. For example, if there are 15 items, the code should have 15 items. DO NOT LEAVE comments like \"<!-- Repeat for each news item -->\" or bad things will happen.\n- For images, use placeholder images from https://placehold.co and include a detailed description of the image in the alt text so that an image generation AI can generate the image later.\n- You can use Google Fonts\n\nReturn only the full code in <svg></svg> tags.\nDo not include markdown \"```\" or \"```svg\" at the start or end.\n\"\"\"\n\nIMPORTED_CODE_SYSTEM_PROMPTS = SystemPrompts(\n    html_tailwind=IMPORTED_CODE_TAILWIND_SYSTEM_PROMPT,\n    react_tailwind=IMPORTED_CODE_REACT_TAILWIND_SYSTEM_PROMPT,\n    bootstrap=IMPORTED_CODE_BOOTSTRAP_SYSTEM_PROMPT,\n    ionic_tailwind=IMPORTED_CODE_IONIC_TAILWIND_SYSTEM_PROMPT,\n    vue_tailwind=IMPORTED_CODE_VUE_TAILWIND_SYSTEM_PROMPT,\n    svg=IMPORTED_CODE_SVG_SYSTEM_PROMPT,\n)\n", "backend/ws/constants.py": "# WebSocket protocol (RFC 6455) allows for the use of custom close codes in the range 4000-4999\nAPP_ERROR_WEB_SOCKET_CODE = 4332\n", "backend/ws/__init__.py": "", "backend/video/utils.py": "# Extract HTML content from the completion string\nimport base64\nimport io\nimport mimetypes\nimport os\nimport tempfile\nimport uuid\nfrom typing import Any, Union, cast\nfrom moviepy.editor import VideoFileClip  # type: ignore\nfrom PIL import Image\nimport math\n\n\nDEBUG = True\nTARGET_NUM_SCREENSHOTS = (\n    20  # Should be max that Claude supports (20) - reduce to save tokens on testing\n)\n\n\nasync def assemble_claude_prompt_video(video_data_url: str) -> list[Any]:\n    images = split_video_into_screenshots(video_data_url)\n\n    # Save images to tmp if we're debugging\n    if DEBUG:\n        save_images_to_tmp(images)\n\n    # Validate number of images\n    print(f\"Number of frames extracted from video: {len(images)}\")\n    if len(images) > 20:\n        print(f\"Too many screenshots: {len(images)}\")\n        raise ValueError(\"Too many screenshots extracted from video\")\n\n    # Convert images to the message format for Claude\n    content_messages: list[dict[str, Union[dict[str, str], str]]] = []\n    for image in images:\n\n        # Convert Image to buffer\n        buffered = io.BytesIO()\n        image.save(buffered, format=\"JPEG\")\n\n        # Encode bytes as base64\n        base64_data = base64.b64encode(buffered.getvalue()).decode(\"utf-8\")\n        media_type = \"image/jpeg\"\n\n        content_messages.append(\n            {\n                \"type\": \"image\",\n                \"source\": {\n                    \"type\": \"base64\",\n                    \"media_type\": media_type,\n                    \"data\": base64_data,\n                },\n            }\n        )\n\n    return [\n        {\n            \"role\": \"user\",\n            \"content\": content_messages,\n        },\n    ]\n\n\n# Returns a list of images/frame (RGB format)\ndef split_video_into_screenshots(video_data_url: str) -> list[Image.Image]:\n    target_num_screenshots = TARGET_NUM_SCREENSHOTS\n\n    # Decode the base64 URL to get the video bytes\n    video_encoded_data = video_data_url.split(\",\")[1]\n    video_bytes = base64.b64decode(video_encoded_data)\n\n    mime_type = video_data_url.split(\";\")[0].split(\":\")[1]\n    suffix = mimetypes.guess_extension(mime_type)\n\n    with tempfile.NamedTemporaryFile(suffix=suffix, delete=True) as temp_video_file:\n        print(temp_video_file.name)\n        temp_video_file.write(video_bytes)\n        temp_video_file.flush()\n        clip = VideoFileClip(temp_video_file.name)\n        images: list[Image.Image] = []\n        total_frames = cast(int, clip.reader.nframes)  # type: ignore\n\n        # Calculate frame skip interval by dividing total frames by the target number of screenshots\n        # Ensuring a minimum skip of 1 frame\n        frame_skip = max(1, math.ceil(total_frames / target_num_screenshots))\n\n        # Iterate over each frame in the clip\n        for i, frame in enumerate(clip.iter_frames()):\n            # Save every nth frame\n            if i % frame_skip == 0:\n                frame_image = Image.fromarray(frame)  # type: ignore\n                images.append(frame_image)\n                # Ensure that we don't capture more than the desired number of frames\n                if len(images) >= target_num_screenshots:\n                    break\n\n        # Close the video file to release resources\n        clip.close()\n\n        return images\n\n\n# Save a list of PIL images to a random temporary directory\ndef save_images_to_tmp(images: list[Image.Image]):\n\n    # Create a unique temporary directory\n    unique_dir_name = f\"screenshots_{uuid.uuid4()}\"\n    tmp_screenshots_dir = os.path.join(tempfile.gettempdir(), unique_dir_name)\n    os.makedirs(tmp_screenshots_dir, exist_ok=True)\n\n    for idx, image in enumerate(images):\n        # Generate a unique image filename using index\n        image_filename = f\"screenshot_{idx}.jpg\"\n        tmp_filepath = os.path.join(tmp_screenshots_dir, image_filename)\n        image.save(tmp_filepath, format=\"JPEG\")\n\n    print(\"Saved to \" + tmp_screenshots_dir)\n\n\ndef extract_tag_content(tag: str, text: str) -> str:\n    \"\"\"\n    Extracts content for a given tag from the provided text.\n\n    :param tag: The tag to search for.\n    :param text: The text to search within.\n    :return: The content found within the tag, if any.\n    \"\"\"\n    tag_start = f\"<{tag}>\"\n    tag_end = f\"</{tag}>\"\n    start_idx = text.find(tag_start)\n    end_idx = text.find(tag_end, start_idx)\n    if start_idx != -1 and end_idx != -1:\n        return text[start_idx : end_idx + len(tag_end)]\n    return \"\"\n"}